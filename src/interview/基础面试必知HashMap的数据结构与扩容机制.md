---
icon: fa-solid fa-paste
date: 2024-09-19
order: 25
categories:
   - Java
tags:
   - Java基础
---

本文详细介绍了Java中 `HashMap` 的数据结构及其工作原理，并深入探讨了它的扩容机制。首先，文章解释了 `HashMap` 内部是如何通过哈希算法来存储和检索数据的，包括链表和红黑树这两种解决哈希冲突的方法。接着，本文详细分析了 `HashMap` 在达到一定负载因子时如何进行扩容操作，并通过代码示例展示了扩容过程中涉及的关键步骤。最后，本文总结了 `HashMap` 的一些重要特性和使用注意事项，帮助读者更好地理解和应用这一核心数据结构。

<!-- more -->

# Java基础面试必知：HashMap的数据结构与扩容机制

在Java开发中， HashMap是使用最为广泛的数据结构之一，它提供了基于键值对的快速存取功能。然而，在面试中，经常会涉及到HashMap的底层实现原理，特别是其数据结构和扩容机制。本文将带你深入了解 HashMap是如何工作的，以及它是如何通过扩容来应对大量数据的情况。

## HashMap的数据结构

HashMap本质上是一个数组，但它并不是一个简单的数组，而是由一系列桶（bucket）组成的数组。每个桶都可以存储一个键值对，也可以存储一个链表或红黑树来处理哈希冲突。

### **1. 哈希算法：**

当一个键值对被加入到HashMap中时，首先会对键进行哈希计算，得到一个哈希码。这个哈希码会被进一步转换成数组索引，以确定键值对应该存储的位置。

### **2. 解决哈希冲突：**

由于哈希函数可能会导致不同的键产生相同的哈希码，因此需要一种方法来处理这种情况。

在Java 8之前， HashMap使用链表来解决哈希冲突；

而在Java 8中，当链表长度达到一定阈值时，链表会被转换成红黑树，以提高查找效率。

## HashMap的扩容机制

当 HashMap中的元素数量达到其容量与负载因子（load factor）的乘积时，就会触发扩容操作。默认情况下， HashMap的初始容量为16，负载因子为0.75，这就意味着当HashMap的容量使用率达到75%时，就认为是时候进行扩容了。

### **1. 扩容时机：**

当 HashMap 的大小超过了容量与负载因子的乘积（当前HashMap的大小 > 当前容量 × 负载因子）时，就会触发扩容。

扩容会创建一个新的更大容量的数组（**新数组是旧数组的两倍**），并将原有数组中的所有键值对重新计算哈希码，分配到新的数组中。

**为什么是扩容两倍？**

当HashMap类使用2的幂扩容，数组大小是2的幂时，哈希函数可以使用位与操作（hash & (length - 1)）有效地计算，而不是使用非2的幂大小时的模运算（hash % length）。这个位与操作利用了数组大小是2的幂这一事实，确保了哈希码的低位被使用，从而实现更均匀地将键分布在桶之间。

### **2. 扩容过程：**

扩容过程中，HashMap会创建一个新的数组，通常是当前容量的两倍。然后，原数组中的所有元素都会被重新哈希，并放置到新的数组中相应的位置。这个过程可能会改变元素在数组中的分布情况，因为哈希码计算的结果可能会有所不同。



## 总结

通过本文的介绍，我们了解到 HashMap 的数据结构是由数组、链表和红黑树组成的，它通过哈希算法来确定键值对的存储位置，并通过扩容机制来应对数据量的增长。理解这些基础知识对于编写高效、可靠的Java程序至关重要。

---

这个文章示例旨在提供一个清晰的结构和内容，帮助读者理解 HashMap 的数据结构及其扩容机制。希望这篇文章能够帮助准备面试的开发者们更好地掌握这一知识点。如果需要进一步修改或有其他要求，请随时告知。