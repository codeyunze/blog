---
date: 2024-12-29
order: 20
categories:
   - 数据与缓存一致性
tags:
   - redis
   - mysql
---

# Redis缓存与数据库数据一致性问题

方案一：延时双删

更新完db数据之后，立马删除一次redis缓存，然后延时1~2秒，再去删除一次redis缓存。

目的：避免并发操作，导致缓存脏数据问题的出现。

优点：实现简单，有效解决大部分场景下的问题。

缺点：延时时间不好确定，操作量大的情况下，可能还是会出现数据被覆盖的问题。



方案二：订阅更新机制

更新完db数据之后，发送一条删除缓存的mq消息，redis监听到这个消息后，立刻去执行缓存删除操作。

优点：实时性，缓存清楚非常及时。

缺点：实现相对复杂，mq要求可靠性，有一定维护成本。



方案三：读写分离架构

适合大数量流量的系统。

更新完db数据之后，由后台线程、定时任务、异步服务等去更新redis缓存数据，达到缓存和数据库数据的基本一致。

优点：缓存压力降低很多。

缺点：实现复杂，需要做好异步的逻辑。



方案四：通过Cancel订阅binlog同步redis

更新完db数据之后，数据库会记录日志到binlog日志文件，然后Cancel会监听并解析binlog日志，然后将解析的数据更新到redis缓存。

优点：业务功能不会增加额外的代码，是扩展实现的。也有一定的实时性

缺点：有一定的维护成本