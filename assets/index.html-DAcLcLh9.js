import{_ as a,e as i,f as e,o as n}from"./app-Cx_oisp2.js";const t="/assets/image-20250309174014938-DQ4bQ3u7.png",l="/assets/image-20250309174305657-D0aK4weo.png",p="/assets/image-20250309174921896-DyomjVIn.png",c="/assets/image-20250309175214729-BQHOixpk.png",r="/assets/image-20250309175338941-CO6MQxBP.png",d="/assets/image-20250309175545705-0CTaRnDV.png",h="/assets/image-20250309175610939-wZ-WsMxi.png",o="/assets/image-20250309180415206-CYQaTkIG.png",g="/assets/image-20250309180524319-BRv6GaVf.png",k="/assets/image-20250309180638573-CXoBj00P.png",m="/assets/image-20250309180908797-DO20bzzt.png",u="/assets/image-20250309181124275-KN8LbdoJ.png",y="/assets/image-20250309181335927-DYweoZNG.png",v="/assets/image-20250309181500176-CWEJz2_B.png",b={};function A(C,s){return n(),i("div",null,s[0]||(s[0]=[e(`<ul><li><strong>多架构支持的挑战</strong> ：随着异构计算（如 ARM、x86、RISC-V 等）的普及，开发者需要为不同硬件平台提供对应的镜像，传统方式需维护多个版本（如 <code>image:v1-amd64</code> 和 <code>image:v1-arm64</code> ），导致版本管理复杂。</li><li><strong>Docker 的解决方案</strong> ：通过 <strong>Manifest List（清单列表）</strong> 将多架构镜像合并到单一版本下，用户只需拉取 <code>image:v1</code> ，Docker 会自动匹配当前平台对应的镜像。</li></ul><h1 id="docker合并多架构镜像到一个镜像方案" tabindex="-1"><a class="header-anchor" href="#docker合并多架构镜像到一个镜像方案"><span>Docker合并多架构镜像到一个镜像方案</span></a></h1><h2 id="拉取镜像" tabindex="-1"><a class="header-anchor" href="#拉取镜像"><span>拉取镜像</span></a></h2><p>先将不同架构的镜像拉取到本地</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pull</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/linux_amd64_nginx:1.26.3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pull</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/linux_arm64_v8_nginx:1.26.3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+t+`" alt="image-20250309174014938"></p><h2 id="修改镜像名" tabindex="-1"><a class="header-anchor" href="#修改镜像名"><span>修改镜像名</span></a></h2><p>将不同架构镜像的 repository 修改一致，在tag 标签里做版本和架构的区分。</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">image</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">tag</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/linux_amd64_nginx:1.26.3</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/nginx:1.26.3_amd64</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">image</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">tag</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/linux_arm64_v8_nginx:1.26.3</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/nginx:1.26.3_arm64</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+l+`" alt="image-20250309174305657"></p><h2 id="推送镜像" tabindex="-1"><a class="header-anchor" href="#推送镜像"><span>推送镜像</span></a></h2><p>这里使用的是阿里云的容器镜像服务，但是不管使用哪家企业提供的镜像服务，其操作过程都是一样的，将本地的修改好名称的镜像推送上去。</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">push</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/nginx:1.26.3_arm64</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">push</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/nginx:1.26.3_amd64</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+p+'" alt="image-20250309174921896"></p><p><img src="'+c+'" alt="image-20250309175214729"></p><h2 id="创建清单" tabindex="-1"><a class="header-anchor" href="#创建清单"><span>创建清单</span></a></h2><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">manifest</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">create</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/nginx:1.26.3</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/nginx:1.26.3_arm64</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/nginx:1.26.3_amd64</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="'+r+'" alt="image-20250309175338941"></p><h2 id="推送清单" tabindex="-1"><a class="header-anchor" href="#推送清单"><span>推送清单</span></a></h2><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">manifest</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">push</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/nginx:1.26.3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="'+d+'" alt="image-20250309175545705"></p><p><img src="'+h+'" alt="image-20250309175610939"></p><h2 id="删除清单" tabindex="-1"><a class="header-anchor" href="#删除清单"><span>删除清单</span></a></h2><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">manifest</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">rm</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/nginx:1.26.3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="验证" tabindex="-1"><a class="header-anchor" href="#验证"><span>验证</span></a></h2><h3 id="arm64架构环境拉取amd64架构镜像验证" tabindex="-1"><a class="header-anchor" href="#arm64架构环境拉取amd64架构镜像验证"><span>arm64架构环境拉取amd64架构镜像验证</span></a></h3><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pull</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--platform</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">linux/amd64</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/nginx:1.26.3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="'+o+'" alt="image-20250309180415206"></p><p><img src="'+g+'" alt="image-20250309180524319"></p><p>运行镜像验证</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">run</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-d</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--name=nginx-test</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-p</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">80:80</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/nginx:1.26.3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="'+k+'" alt="image-20250309180638573"></p><p>运行镜像时可以看到，已经有警告提示信息说架构不匹配了。这就证明拉取到镜像的确实是amd64架构的镜像。</p><h3 id="arm64架构环境拉取arm64架构镜像验证" tabindex="-1"><a class="header-anchor" href="#arm64架构环境拉取arm64架构镜像验证"><span>arm64架构环境拉取arm64架构镜像验证</span></a></h3><p>先清理上一步测试的容器和镜像。</p><p><img src="'+m+`" alt="image-20250309180908797"></p><p>关闭并删除之前测试的容器和镜像。</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">stop</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">d23741cd8db3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">rm</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">d23741cd8db3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">rmi</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/nginx:1.26.3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+u+'" alt="image-20250309181124275"></p><p>拉取arm64镜像</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pull</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--platform</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">linux/arm64</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/nginx:1.26.3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="'+y+'" alt="image-20250309181335927"></p><p>运行镜像验证</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">run</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-d</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">--name=nginx-test</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-p</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">80:80</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">registry.cn-guangzhou.aliyuncs.com/devyunze/nginx:1.26.3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="'+v+'" alt="image-20250309181500176"></p><p>可以看到容器运行成功，并成功访问到nginx。</p><p>证明此次拉取到镜像的确实是arm64架构的镜像。</p><p>至此将多个架构镜像合并到一个镜像里的操作可以宣告成功了。</p>',48)]))}const x=a(b,[["render",A],["__file","index.html.vue"]]),B=JSON.parse('{"path":"/article/q5t9hc44/","title":"Docker合并多架构镜像到一个镜像方案","lang":"zh-CN","frontmatter":{"title":"Docker合并多架构镜像到一个镜像方案","createTime":"2025/03/09 17:36:30","permalink":"/article/q5t9hc44/","tags":["手册","docker","镜像"],"description":"多架构支持的挑战 ：随着异构计算（如 ARM、x86、RISC-V 等）的普及，开发者需要为不同硬件平台提供对应的镜像，传统方式需维护多个版本（如 image:v1-amd64 和 image:v1-arm64 ），导致版本管理复杂。 Docker 的解决方案 ：通过 Manifest List（清单列表） 将多架构镜像合并到单一版本下，用户只需拉取 ...","head":[["meta",{"property":"og:url","content":"https://blog.gaohan.asia/article/q5t9hc44/"}],["meta",{"property":"og:site_name","content":"云泽汇码"}],["meta",{"property":"og:title","content":"Docker合并多架构镜像到一个镜像方案"}],["meta",{"property":"og:description","content":"多架构支持的挑战 ：随着异构计算（如 ARM、x86、RISC-V 等）的普及，开发者需要为不同硬件平台提供对应的镜像，传统方式需维护多个版本（如 image:v1-amd64 和 image:v1-arm64 ），导致版本管理复杂。 Docker 的解决方案 ：通过 Manifest List（清单列表） 将多架构镜像合并到单一版本下，用户只需拉取 ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-07-29T01:29:41.000Z"}],["meta",{"property":"article:tag","content":"手册"}],["meta",{"property":"article:tag","content":"docker"}],["meta",{"property":"article:tag","content":"镜像"}],["meta",{"property":"article:modified_time","content":"2025-07-29T01:29:41.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Docker合并多架构镜像到一个镜像方案\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-07-29T01:29:41.000Z\\",\\"author\\":[]}"]]},"headers":[],"readingTime":{"minutes":2.17,"words":651},"git":{"updatedTime":1753752581000,"contributors":[{"name":"yunze","username":"yunze","email":"56632502+YUNZE-GH@users.noreply.github.com","commits":1,"avatar":"https://avatars.githubusercontent.com/yunze?v=4","url":"https://github.com/yunze"},{"name":"yunze","username":"yunze","email":"834363368@qq.com","commits":1,"avatar":"https://avatars.githubusercontent.com/yunze?v=4","url":"https://github.com/yunze"}]},"autoDesc":true,"filePathRelative":"manual/323.Docker合并多架构镜像到一个镜像方案.md","categoryList":[{"id":"3c78b3","sort":10003,"name":"manual"}]}');export{x as comp,B as data};
