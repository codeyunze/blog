import{_ as a,e as p,f as n,o as c}from"./app-Cx_oisp2.js";const i={};function e(l,s){return c(),p("div",null,s[0]||(s[0]=[n(`<p>将从 ReentrantLock 的功能作用、解决的问题、使用方式、实现原理来介绍。</p><hr><h3 id="_1-功能作用" tabindex="-1"><a class="header-anchor" href="#_1-功能作用"><span>1. 功能作用</span></a></h3><p><code>ReentrantLock</code> 是 Java 提供的一个<strong>可重入的互斥锁</strong>，它提供了与 <code>synchronized</code> 关键字类似的同步功能，但是拥有更强大的灵活性和高级特性。</p><p><strong>核心功能包括：</strong></p><ul><li><strong>互斥访问</strong>：保证同一时间只有一个线程能持有锁。</li><li><strong>可重入性</strong>：同一个线程可以多次获取同一把锁而不会被自己阻塞。</li><li><strong>尝试非阻塞获取锁</strong>：<code>tryLock()</code> 方法可以尝试获取锁，如果失败不会阻塞线程。</li><li><strong>可中断的锁等待</strong>：<code>lockInterruptibly()</code> 方法允许在等待锁的过程中响应中断。</li><li><strong>公平锁与非公平锁</strong>：可以选择创建公平锁（先来先服务）或非公平锁（默认，允许插队）。</li></ul><hr><h3 id="_2-解决了什么问题" tabindex="-1"><a class="header-anchor" href="#_2-解决了什么问题"><span>2. 解决了什么问题</span></a></h3><p>它解决了 <code>synchronized</code> 关键字在一些场景下的局限性：</p><ol><li><strong>无法中断的等待</strong>：使用 <code>synchronized</code> 时，若线程无法获取锁，会一直阻塞，无法被中断。</li><li><strong>非阻塞地获取锁</strong>：<code>synchronized</code> 无法尝试获取锁，要么成功，要么无限等待。</li><li><strong>不公平的锁竞争</strong>：<code>synchronized</code> 的锁是非公平的，可能导致某些线程长时间饥饿。</li><li><strong>单一的等待条件</strong>：一个 <code>synchronized</code> 锁只关联一个等待队列（通过 <code>wait/notify</code>），无法实现多条件通知。</li></ol><p><code>ReentrantLock</code> 提供了更细粒度的锁控制，让开发者能构建更复杂的同步结构。</p><hr><h3 id="_3-使用方式" tabindex="-1"><a class="header-anchor" href="#_3-使用方式"><span>3. 使用方式</span></a></h3><p><strong>标准使用模板：</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">java</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">util</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">concurrent</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">locks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ReentrantLock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">class</span><span class="space"> </span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">Counter</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">private</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">final</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ReentrantLock</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">lock</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">new</span><span class="space"> </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ReentrantLock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">private</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">int</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">count</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">void</span><span class="space"> </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">increment</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">lock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">lock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">获取锁</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">try</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">count</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">++</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">其他需要同步的操作...</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">finally</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">lock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">unlock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">必须在finally块中释放锁！</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">使用tryLock的示例</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">boolean</span><span class="space"> </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">tryIncrement</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">if</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">lock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">tryLock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">())</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">尝试获取锁，立即返回</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">try</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">count</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">++</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">return</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">true</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">finally</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">lock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">unlock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">else</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">获取锁失败，执行其他逻辑</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">return</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">false</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="_4-实现原理分析" tabindex="-1"><a class="header-anchor" href="#_4-实现原理分析"><span>4. 实现原理分析</span></a></h3><p><code>ReentrantLock</code> 的底层实现依赖于三个核心组件：</p><h4 id="a-aqs" tabindex="-1"><a class="header-anchor" href="#a-aqs"><span>a) AQS</span></a></h4><p><code>ReentrantLock</code> 的所有同步功能都委托给了一个内部类 <code>Sync</code>，而 <code>Sync</code> 继承自 <strong><code>AbstractQueuedSynchronizer</code></strong>。AQS 是 JUC 包的核心，它提供了一个用于构建锁和同步器的框架。</p><h4 id="b-状态变量" tabindex="-1"><a class="header-anchor" href="#b-状态变量"><span>b) 状态变量</span></a></h4><p>AQS 内部维护了一个 <code>volatile</code> 的 <code>state</code> 变量：</p><ul><li><code>state == 0</code>：锁未被任何线程持有。</li><li><code>state &gt;= 1</code>：锁已被线程持有。数值代表持有线程的<strong>重入次数</strong>。</li></ul><h4 id="c-clh队列的变体" tabindex="-1"><a class="header-anchor" href="#c-clh队列的变体"><span>c) CLH队列的变体</span></a></h4><p>AQS 通过一个 FIFO 的等待队列来管理所有等待获取锁的线程。</p><h4 id="工作流程" tabindex="-1"><a class="header-anchor" href="#工作流程"><span>工作流程：</span></a></h4><p><strong>加锁 (<code>lock()</code>)：</strong></p><ol><li>通过 <strong>CAS</strong> 操作尝试将 <code>state</code> 从 0 改为 1。</li><li>如果成功，则设置当前线程为独占锁的持有者。</li><li>如果失败（锁已被占用），则检查持有者是否是当前线程（重入），如果是则 <code>state + 1</code>。</li><li>如果都不是，则将当前线程封装成节点加入等待队列并挂起。</li></ol><p><strong>解锁 (<code>unlock()</code>)：</strong></p><ol><li>将 <code>state</code> 减 1（对于重入，可能只是减少计数）。</li><li>如果 <code>state</code> 变为 0，则完全释放锁，清空独占线程。</li><li>唤醒等待队列中下一个符合条件的线程去尝试获取锁。</li></ol><h4 id="公平-vs-非公平" tabindex="-1"><a class="header-anchor" href="#公平-vs-非公平"><span>公平 vs 非公平：</span></a></h4><ul><li><strong>非公平锁</strong>：线程在尝试获取锁时，不管等待队列中是否有其他线程，直接尝试 CAS 抢锁。性能高，但可能导致饥饿。</li><li><strong>公平锁</strong>：线程在尝试获取锁时，如果等待队列不为空，则自觉排队。保证了公平性，但性能相对较低。</li></ul><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><p><code>ReentrantLock</code> 是一个功能丰富的互斥锁，通过 <strong>AQS 框架</strong>、<strong>CAS 操作</strong> 和 <strong>等待队列</strong> 实现了比 <code>synchronized</code> 更灵活的锁机制。它是解决复杂并发问题的强大工具，但在简单场景下，<code>synchronized</code> 因其简洁性仍是首选。</p>`,34)]))}const h=a(i,[["render",e],["__file","index.html.vue"]]),k=JSON.parse('{"path":"/interview/ed3mh5l3/","title":"ReenTrantLock可重入的互斥锁","lang":"zh-CN","frontmatter":{"title":"ReenTrantLock可重入的互斥锁","createTime":"2025/10/13 16:23:19","permalink":"/interview/ed3mh5l3/","description":"将从 ReentrantLock 的功能作用、解决的问题、使用方式、实现原理来介绍。 1. 功能作用 ReentrantLock 是 Java 提供的一个可重入的互斥锁，它提供了与 synchronized 关键字类似的同步功能，但是拥有更强大的灵活性和高级特性。 核心功能包括： 互斥访问：保证同一时间只有一个线程能持有锁。 可重入性：同一个线程可以多...","head":[["meta",{"property":"og:url","content":"https://blog.gaohan.asia/interview/ed3mh5l3/"}],["meta",{"property":"og:site_name","content":"云泽汇码"}],["meta",{"property":"og:title","content":"ReenTrantLock可重入的互斥锁"}],["meta",{"property":"og:description","content":"将从 ReentrantLock 的功能作用、解决的问题、使用方式、实现原理来介绍。 1. 功能作用 ReentrantLock 是 Java 提供的一个可重入的互斥锁，它提供了与 synchronized 关键字类似的同步功能，但是拥有更强大的灵活性和高级特性。 核心功能包括： 互斥访问：保证同一时间只有一个线程能持有锁。 可重入性：同一个线程可以多..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-10-26T12:40:27.000Z"}],["meta",{"property":"article:modified_time","content":"2025-10-26T12:40:27.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"ReenTrantLock可重入的互斥锁\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-10-26T12:40:27.000Z\\",\\"author\\":[]}"]]},"headers":[],"readingTime":{"minutes":3.27,"words":982},"git":{"updatedTime":1761482427000,"contributors":[{"name":"yunze","username":"yunze","email":"834363368@qq.com","commits":1,"avatar":"https://avatars.githubusercontent.com/yunze?v=4","url":"https://github.com/yunze"}]},"autoDesc":true,"filePathRelative":"notes/interview/5.Concurrent/6.ReenTrantLock可重入的互斥锁.md"}');export{h as comp,k as data};
