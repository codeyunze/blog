import{_ as c,e as t,f as l,g as a,h as p,i,j as e,r as h,o as d}from"./app-Cx_oisp2.js";const k="/assets/image-20250828212149251-B2UR4a42.png",r={};function A(D,s){const n=h("RouteLink");return d(),t("div",null,[s[12]||(s[12]=l(`<h2 id="压测" tabindex="-1"><a class="header-anchor" href="#压测"><span>压测</span></a></h2><p>压测命令</p><div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">20个线程，100W个请求，测试redis的set指令(写数据)</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">redis-benchmark</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-a</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">foobared</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-t</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">set</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-n</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1000000</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">-c</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">20</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>可使用redis-benchmark --help指令查看更多参数</p></blockquote><p><img src="`+k+`" alt="image-20250828212149251"></p><h2 id="redis的数据持久化" tabindex="-1"><a class="header-anchor" href="#redis的数据持久化"><span>Redis的数据持久化</span></a></h2><p>redis的数据持久方案有四种，分别是无持久化、 RDB 、 AOF 、RDB + AOF。</p><p>生产环境建议使用 RDB + AOF 两种结合一起使用。</p><h3 id="无持久化" tabindex="-1"><a class="header-anchor" href="#无持久化"><span>无持久化</span></a></h3><p>不进行数据持久化，完全将Redis当做缓存使用。</p><h3 id="rdb" tabindex="-1"><a class="header-anchor" href="#rdb"><span>RDB</span></a></h3><p>按照一定的时间间隔来进行所有数据备份。</p><h4 id="优点" tabindex="-1"><a class="header-anchor" href="#优点"><span>优点</span></a></h4><p>RDB文件非常紧凑，适合定期备份数据，适合灾难恢复。</p><p>RDB备份时性能非常快，对主线程的性能几乎没有影响。主线程只需要启动一个负责数据备份的子线程即可。对主线程的IO性能几乎没有影响。</p><p>与AOF相比，RDB在进行大数据量重启时会快很多。</p><p>如果需要迁移数据，可直接使用复制rdb文件给到另一台redis服务。</p><h4 id="缺点" tabindex="-1"><a class="header-anchor" href="#缺点"><span>缺点</span></a></h4><p>无法实时备份，会有数据丢失的可能。</p><h4 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h4><p>开启：</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">rdbcompression</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">yes</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">开启RDB文件压缩（默认）</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">或</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">rdbcompression</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">no</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">关闭RDB文件压缩</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>持久化策略：</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">save</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&lt;seconds&gt;</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&lt;keys-changed&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>seconds：时间窗口（秒）</p><p>keys-changed：在时间窗口内发生改变的键的数量。</p><p><strong>含义：</strong> 如果在 <code>&lt;seconds&gt;</code> 秒内，至少有 <code>&lt;keys-changed&gt;</code> 个键发生了变化（新增、修改、删除），Redis 就会自动触发一次 BGSAVE 操作，创建数据快照。</p><p>案例：</p><p>只要满足其中任意一个条件，就会触发备份。</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">save</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">900</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">1</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">在900秒（15分钟）内，如果至少有1个键发生变化，则触发保存</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">save</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">300</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">10</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">在300秒（5分钟）内，如果至少有10个键发生变化，则触发保存</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">save</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">60</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">10000</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">在60秒（1分钟）内，如果至少有10000个键发生变化，则触发保存</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="aof" tabindex="-1"><a class="header-anchor" href="#aof"><span>AOF</span></a></h3><p>记录每次写操作的命令，可通过重放的的方式进行数据恢复。</p><h4 id="优点-1" tabindex="-1"><a class="header-anchor" href="#优点-1"><span>优点</span></a></h4><p>AOF持久化更安全，默认每秒进行一次AOF写入，就算服务崩溃也只会丢失1秒的数据。</p><p>不会出现记录不完整的情况，即使因为一些特殊的原因造成了 aof 的文件记录不完整，也可以使用 <code>redis-check-aof</code> 工具进行修复。</p><p>AOF记录操作的方式简单易懂，可手动删除日志文件里不要的操作语句（误操作的语句，例如操作了flushall）。</p><h4 id="缺点-1" tabindex="-1"><a class="header-anchor" href="#缺点-1"><span>缺点</span></a></h4><p>aof文件太大。（当然Redis会自动切换新的日志文件）</p><p>aof备份性能不如RDB。</p><p>开启：</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">开启AOF持久化模式</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">appendonly</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">yes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">指定AOF文件名（默认即可）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">appendfilename</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">appendonly.aof</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">设置fsync同步策略（推荐每秒同步，在安全与性能间取得平衡）</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">appendfsync</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">everysec</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rdb-aof" tabindex="-1"><a class="header-anchor" href="#rdb-aof"><span>RDB + AOF</span></a></h3><p>进行数据备份的同时，记录写操作。</p><p>既保证了数据安全，又保证了快速恢复和备份的效率。</p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#######################</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">SNAPSHOTTING</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">(RDB)</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">############################</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">启用RDB快照</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">save</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">900</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">1</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">15分钟内至少1个键变更则触发</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">save</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">300</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">10</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">5分钟内至少10个键变更则触发</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">save</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">60</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">10000</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">1分钟内至少10000个键变更则触发</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">stop-writes-on-bgsave-error</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">yes</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">BGSAVE出错时停止接收写请求，是一种保护机制</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">rdbcompression</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">yes</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">开启RDB文件压缩，节省空间</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">rdbchecksum</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">yes</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">对RDB文件进行校验，增加数据可靠性</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">dbfilename</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">dump.rdb</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">RDB文件名</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">dir</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">./</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">RDB和AOF文件保存目录（通常需要改为持久化卷）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#######################</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">APPEND</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">ONLY</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">MODE</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">(AOF)</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">########################</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">启用AOF持久化</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">appendonly</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">yes</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">最关键：开启AOF功能</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">appendfilename</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">appendonly.aof</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">AOF文件名</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">AOF</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">fsync策略</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">(推荐everysec)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">appendfsync</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">everysec</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">在安全与性能间取得最佳平衡</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">AOF重写配置</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">no-appendfsync-on-rewrite</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">no</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">重写时不阻塞fsync</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">auto-aof-rewrite-percentage</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">100</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">文件大小增长100%后触发重写</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">auto-aof-rewrite-min-size</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">64mb</span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">AOF文件至少达到64MB才触发重写</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">aof-load-truncated</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">yes</span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">如果AOF文件尾部损坏，仍加载</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">truncated</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">的数据</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="数据恢复流程" tabindex="-1"><a class="header-anchor" href="#数据恢复流程"><span>数据恢复流程</span></a></h4><p>当Redis重启时，它会按以下顺序优先恢复数据：</p><blockquote><p><strong>优先加载 AOF 文件</strong> -&gt; <strong>加载 RDB 文件</strong></p></blockquote><p>因为AOF文件通常包含更完整的最新数据（直到宕机前最后一秒的命令）。RDB文件可能只是几分钟前的一个快照。</p><h2 id="多节点" tabindex="-1"><a class="header-anchor" href="#多节点"><span>多节点</span></a></h2><h3 id="主从" tabindex="-1"><a class="header-anchor" href="#主从"><span>主从</span></a></h3><p>解决了数据安全性问题。（主节点崩溃，还有从节点复制的数据）</p><p>主节点负责写，从节点负责读（从节点无法写）（机制和mysql的主从类似）。</p>`,53)),a("p",null,[s[1]||(s[1]=p("搭建方式：《 ")),i(n,{to:"/database/122.Redis%E7%9A%84%E4%B8%BB%E4%BB%8E%E6%9E%B6%E6%9E%84%E9%85%8D%E7%BD%AE.html"},{default:e(()=>s[0]||(s[0]=[p("Redis的主从架构配置")])),_:1}),s[2]||(s[2]=p(" 》"))]),s[13]||(s[13]=a("p",null,"如果在搭建主从时，从节点已经有了数据会怎么样呢？",-1)),s[14]||(s[14]=a("p",null,"答：主从同步完成后，从节点的数据被主节点覆盖。",-1)),s[15]||(s[15]=a("p",null,"缺点：主节点挂了之后，需要认为介入操作切换主节点。（哨兵就是将优化掉了需要人为介入）",-1)),s[16]||(s[16]=a("h3",{id:"哨兵",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#哨兵"},[a("span",null,"哨兵")])],-1)),s[17]||(s[17]=a("p",null,"解决了服务安全问题。（主节点异常，哨兵集群会从从节点中选出新的主节点）",-1)),a("p",null,[s[4]||(s[4]=p("搭建方式：《 ")),i(n,{to:"/database/123.Redis%E7%9A%84%E5%93%A8%E5%85%B5%E6%9E%B6%E6%9E%84%E9%85%8D%E7%BD%AE.html"},{default:e(()=>s[3]||(s[3]=[p("Redis的哨兵架构配置")])),_:1}),s[5]||(s[5]=p(" 》"))]),s[18]||(s[18]=l('<h4 id="选举操作流程" tabindex="-1"><a class="header-anchor" href="#选举操作流程"><span>选举操作流程</span></a></h4><ol><li><p>sentinel集群会选举一个sentinel服务节点为leader（将由这个leader负责向所有的redis节点发送命令，协调整个故障切换过程）。</p></li><li><p>在剩余的健康的从节点中，选举出新的master</p><ul><li>首先检查是否有提前配置的优先节点：各个服务节点的redis.conf中的 <code>replica-priority</code> 配置最低 的从节点。这个配置的默认值是100。如果大家的配置都一样，就进入下一个检查规则。</li><li>然后检查复制偏移量offset最大的从节点。也就是找同步数据最快的slave节点。因为他的数据是 最全的。如果大家的offset还是一样的，就进入下一个规则。</li><li>最后按照slave的RunID字典顺序最小的节点。</li></ul></li><li><p>切换新的主节点</p><p>leader给新的主节点执行 <code>slave of no one</code> 操作，正式将其提升为主节点，再给其他从节点发送 <code>slave of</code> 指令，让其他的slave节点成为新master节点的从节点。</p></li><li><p>如果旧的主节点恢复了，leader会让他降为新的从节点，从新的master节点上同步数据，然后恢复工作。</p></li></ol><p>缺点：</p><p>所有节点都存储 全量数据，每个从节点都是主节点的完整副本，资源浪费。</p><p>扩展性方面，哨兵的性能和容量受限于单台机器的上限。</p><p>客户端需要频繁切换master。</p><h3 id="集群" tabindex="-1"><a class="header-anchor" href="#集群"><span>集群</span></a></h3><p>同时解决了数据安全性问题和服务安全问题。</p>',8)),a("p",null,[s[7]||(s[7]=p("搭建方式：《 ")),i(n,{to:"/database/124.Redis%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE.html"},{default:e(()=>s[6]||(s[6]=[p("Redis的集群搭建配置")])),_:1}),s[8]||(s[8]=p(" 》"))]),s[19]||(s[19]=a("p",null,"Redis集群是多主多从。",-1)),s[20]||(s[20]=a("p",null,"Redis集群设置16384个哈希槽。每个key会通过CRC16校验后，对16384取模，来决定放到哪个槽。集群的每个节点负责一部分的hash槽。",-1)),a("p",null,[s[10]||(s[10]=p("集群主节点选举原理 《 ")),i(n,{to:"/database/124.Redis%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE.html#%E9%9B%86%E7%BE%A4%E7%9A%84%E9%80%89%E4%B8%BE%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"},{default:e(()=>s[9]||(s[9]=[p("Redis的集群的选举原理分析")])),_:1}),s[11]||(s[11]=p(" 》"))])])}const g=c(r,[["render",A],["__file","index.html.vue"]]),y=JSON.parse('{"path":"/interview/d2h6ohyh/","title":"Redis数据安全性分析","lang":"zh-CN","frontmatter":{"title":"Redis数据安全性分析","createTime":"2025/08/28 08:45:47","permalink":"/interview/d2h6ohyh/","description":"压测 压测命令 可使用redis-benchmark --help指令查看更多参数 image-20250828212149251 Redis的数据持久化 redis的数据持久方案有四种，分别是无持久化、 RDB 、 AOF 、RDB + AOF。 生产环境建议使用 RDB + AOF 两种结合一起使用。 无持久化 不进行数据持久化，完全将Redis当...","head":[["meta",{"property":"og:url","content":"https://blog.gaohan.asia/interview/d2h6ohyh/"}],["meta",{"property":"og:site_name","content":"云泽汇码"}],["meta",{"property":"og:title","content":"Redis数据安全性分析"}],["meta",{"property":"og:description","content":"压测 压测命令 可使用redis-benchmark --help指令查看更多参数 image-20250828212149251 Redis的数据持久化 redis的数据持久方案有四种，分别是无持久化、 RDB 、 AOF 、RDB + AOF。 生产环境建议使用 RDB + AOF 两种结合一起使用。 无持久化 不进行数据持久化，完全将Redis当..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-30T09:10:24.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-30T09:10:24.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Redis数据安全性分析\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-08-30T09:10:24.000Z\\",\\"author\\":[]}"]]},"headers":[],"readingTime":{"minutes":6.13,"words":1839},"git":{"updatedTime":1756545024000,"contributors":[{"name":"yunze","username":"yunze","email":"834363368@qq.com","commits":2,"avatar":"https://avatars.githubusercontent.com/yunze?v=4","url":"https://github.com/yunze"}]},"autoDesc":true,"filePathRelative":"notes/interview/2.Redis/3.Redis数据安全性分析.md"}');export{g as comp,y as data};
