import{_ as i,e as o,f as s,g as p,h as t,i as r,j as d,r as n,o as c}from"./app-Cx_oisp2.js";const l="/assets/Redis%E9%9B%86%E7%BE%A4%E7%A4%BA%E6%84%8F%E5%9B%BE-BJRZOxOF.svg",m="/assets/Redis%E9%9B%86%E7%BE%A4%E8%84%91%E8%A3%82%E7%A4%BA%E6%84%8F%E5%9B%BE-DT31rJk1.svg",E="/assets/Redis%E9%9B%86%E7%BE%A4%E8%84%91%E8%A3%82%E7%A4%BA%E6%84%8F%E5%9B%BE2-DCUhO18c.svg",R="/assets/Redis%E9%9B%86%E7%BE%A4%E8%84%91%E8%A3%82%E7%A4%BA%E6%84%8F%E5%9B%BE3-ghIuWjca.svg",g={};function u(h,e){const a=n("RouteLink");return c(),o("div",null,[e[3]||(e[3]=s('<p>只要是集群的服务，就会存在可能出现脑裂问题的情况，Redis集群也不例外。</p><p>在网络分区的情况下，可能会出现在一个集群里出现多个主节点共同提供数据的写服务，从而会导致集群内的数据同步出现问题，使数据不一致。</p><h1 id="redis集群的脑裂问题" tabindex="-1"><a class="header-anchor" href="#redis集群的脑裂问题"><span>Redis集群的脑裂问题</span></a></h1><p>Redis集群示意图如下</p><p><img src="'+l+'" alt="Redis集群示意图"></p><h2 id="什么是脑裂" tabindex="-1"><a class="header-anchor" href="#什么是脑裂"><span>什么是脑裂</span></a></h2><p>在Redis集群中，是划分了主从节点的，主节点会提供写服务，从节点只提供读服务，从节点会从主节点去同步数据。</p>',7)),p("p",null,[e[1]||(e[1]=t("当主节点出现网络波动，导致一个小集群里的主节点无法和其他的节点服务进行通信时，小集群里失去了主节点的从节点们就会发出消息，请求重新选举出一个新的主节点。（选举机制可以参考 ")),r(a,{to:"/database/Redis%E7%9A%84%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA.html"},{default:d(()=>e[0]||(e[0]=[t("Redis的集群搭建")])),_:1}),e[2]||(e[2]=t(" 里的“集群的选举原理分析”）"))]),e[4]||(e[4]=s('<p>这就会导致一个问题，这个小集群里就会有两个主节点对外提供写服务了（都提供了写操作，但又不会也无法互相同步），会使这个小集群的数据出现不一致的情况，这就是分布式系统里的脑裂。</p><p><img src="'+m+'" alt="Redis集群脑裂示意图"></p><h2 id="redis预防出现脑裂问题的方案" tabindex="-1"><a class="header-anchor" href="#redis预防出现脑裂问题的方案"><span>Redis预防出现脑裂问题的方案</span></a></h2><p>Redis集群为了预防出现脑裂情况，提供了 <code>min‐replicas‐to‐write</code> 配置项，配置在 <code>redis-cluster.conf</code> 文件里。</p><p>该配置的作用是在主节点写数据时，写数据成功最少同步的slave数量，这个数量可以模仿大于半数机制配置，比如，集群总共三个节点可以配置1，加上自己就是2，超过了半数。</p><p>这样另一个主节点只有自己一个节点，没有从节点同步，所以达不到最少同步slave数量要求，该主节点的数据就无法真正的写入。</p><p>所以集群的节点数量一般为奇数，就是为了方便主节点出现异常时，从节点进行新的主节点选举。</p><blockquote><p>注意：这个配置在一定程度上会影响集群的可用性，比如slave要是少于1个，这个集群就算主节点正常也不能提供服务了，需要具体场景权衡选择</p></blockquote><p>但是， <code>min‐replicas‐to‐write</code> 配置也并不能完全避免脑裂的问题。</p><p>例如</p><p>现一个小集群里有5个节点（5个节点，min‐replicas‐to‐write一般就配置为2或以上），主节点网络出现问题，由下图1变成了图2。</p><p>图1：</p><p><img src="'+E+'" alt="Redis集群脑裂示意图2"></p><p>图2：</p><p><img src="'+R+'" alt="Redis集群脑裂示意图3"></p><p>集群由图1变成图2之后，从节点们就会进行新的主节点选举，在他们选举时，主节点-1依旧在提供写入操作，写入到主节点-1之后，主节点-1同步到从节点-a成功（网络是正常的），主节点-1同步到从节点-c时（网络是异常的），因为从节点同步数据的延迟时间是10s（延迟时间配置 <code>min-replicas-max-lag</code> ，单位为秒），所以只要从节点-c在10秒内同步数据，主节点-1就能写入数据成功。</p><p>所以如果主节点-1向从节点-c同步数据时，还没有超过10秒，主节点-1的网络恢复了正常，并将数据成功同步到了从节点-c，这样主节点-1写入的数据同步到了2个从节点里，因此主节点-1写入数据成功。</p><p>但是此时从节点-b、c、d也选出了新的主节点，假如新的主节点为b，那么旧的主节点-1会变成新主节点-b的从节点，那么旧主节点-1刚刚写入的数据，就会被覆盖。</p><p>因此即使配置了 <code>min‐replicas‐to‐write</code> ，也依旧会导致数据不一致的问题，只是可以缓解出现脑裂的问题。</p>',19))])}const y=i(g,[["render",u],["__file","index.html.vue"]]),A=JSON.parse('{"path":"/article/2adcj2kb/","title":"Redis集群的脑裂问题","lang":"zh-CN","frontmatter":{"title":"Redis集群的脑裂问题","createTime":"2025/03/06 14:03:35","permalink":"/article/2adcj2kb/","tags":["redis","问题解决方案","脑裂"],"description":"只要是集群的服务，就会存在可能出现脑裂问题的情况，Redis集群也不例外。 在网络分区的情况下，可能会出现在一个集群里出现多个主节点共同提供数据的写服务，从而会导致集群内的数据同步出现问题，使数据不一致。 Redis集群的脑裂问题 Redis集群示意图如下 Redis集群示意图 什么是脑裂 在Redis集群中，是划分了主从节点的，主节点会提供写服务，从...","head":[["meta",{"property":"og:url","content":"https://blog.gaohan.asia/article/2adcj2kb/"}],["meta",{"property":"og:site_name","content":"云泽汇码"}],["meta",{"property":"og:title","content":"Redis集群的脑裂问题"}],["meta",{"property":"og:description","content":"只要是集群的服务，就会存在可能出现脑裂问题的情况，Redis集群也不例外。 在网络分区的情况下，可能会出现在一个集群里出现多个主节点共同提供数据的写服务，从而会导致集群内的数据同步出现问题，使数据不一致。 Redis集群的脑裂问题 Redis集群示意图如下 Redis集群示意图 什么是脑裂 在Redis集群中，是划分了主从节点的，主节点会提供写服务，从..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-03-09T10:39:32.000Z"}],["meta",{"property":"article:tag","content":"redis"}],["meta",{"property":"article:tag","content":"问题解决方案"}],["meta",{"property":"article:tag","content":"脑裂"}],["meta",{"property":"article:modified_time","content":"2025-03-09T10:39:32.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Redis集群的脑裂问题\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-03-09T10:39:32.000Z\\",\\"author\\":[]}"]]},"headers":[],"readingTime":{"minutes":3.7,"words":1110},"git":{"updatedTime":1741516772000,"contributors":[{"name":"yunze","username":"yunze","email":"56632502+YUNZE-GH@users.noreply.github.com","commits":5,"avatar":"https://avatars.githubusercontent.com/yunze?v=4","url":"https://github.com/yunze"}]},"autoDesc":true,"filePathRelative":"database/126.Redis集群的脑裂问题.md","categoryList":[{"id":"11e0ee","sort":10005,"name":"database"}]}');export{y as comp,A as data};
