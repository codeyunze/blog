import{_ as d,e as i,f as s,g as e,h as a,o as n}from"./app-Cx_oisp2.js";const l={},o={class:"MathJax",jax:"SVG",style:{position:"relative"}},r={style:{"vertical-align":"0"},xmlns:"http://www.w3.org/2000/svg",width:"2.119ex",height:"1.887ex",role:"img",focusable:"false",viewBox:"0 -833.9 936.6 833.9","aria-hidden":"true"},p={class:"MathJax",jax:"SVG",style:{position:"relative"}},T={style:{"vertical-align":"-0.546ex"},xmlns:"http://www.w3.org/2000/svg",width:"4.814ex",height:"2.116ex",role:"img",focusable:"false",viewBox:"0 -694 2127.7 935.4","aria-hidden":"true"};function h(Q,t){return n(),i("div",null,[t[10]||(t[10]=s('<h2 id="redis7由ziplist替换为listpack的原因" tabindex="-1"><a class="header-anchor" href="#redis7由ziplist替换为listpack的原因"><span>redis7由ziplist替换为listpack的原因</span></a></h2><h3 id="ziplist" tabindex="-1"><a class="header-anchor" href="#ziplist"><span>ziplist</span></a></h3><p>ziplist是由连续内存块组成的顺序性数据结构，整个结构有点类似于数组。可以在任意一端进行push/pop操作时间复杂度都是O(1)。</p><p>ziplist这个 &quot;数组&quot; 的每一个元素节点（entry），就相当于hash数据类型的value里的一个键值对。</p><p>entry里分为三个部分</p><table><thead><tr><th>previous_entry_length</th><th>encoding</th><th>content</th></tr></thead><tbody><tr><td>记录前一个节点的长度，占1个字节或5个字节</td><td>content的编码属性（字符串还是整数），以及content的长度。占用1个字节。</td><td>负责保存节点的数据</td></tr></tbody></table><p><strong>绝大多数情况下，节点长度都很小</strong>。在 ziplist 这种为“小元素”设计的结构中，相邻节点长度小于 254 字节是普遍情况。此时每个 <code>previous_entry_length</code> 字段仅需 <strong>1字节</strong>，达到了极致的空间节省。</p><p>只有遇到极少数 “大节点” 时，才为其后继节点的 <code>previous_entry_length</code> 字段付出 5 字节的代价。这是一种典型的“按需付费”策略。</p><p>previous_entry_length字段的用处就是方便反向遍历，遍历时需要知道下一个元素的长度，反向遍历时，previous_entry_length就是下一个元素的长度。</p>',9)),e("p",null,[t[2]||(t[2]=a("如果在前面插入了一个内容很长的元素a，这个元素a的内容长度超过了254个字节，所以如果要记录元素a的长度则需要5个字节（ 1个字节8bit，也就是这个字节能表示的最大数字是 ")),e("mjx-container",o,[(n(),i("svg",r,t[0]||(t[0]=[s('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z"></path></g></g></g></g></g>',1)]))),t[1]||(t[1]=e("mjx-assistive-mml",{unselectable:"on",display:"inline"},[e("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[e("msup",null,[e("mn",null,"2"),e("mrow",{"data-mjx-texclass":"ORD"},[e("mn",null,"8")])])])],-1))]),t[3]||(t[3]=a(" = 256），如果元素a后面的元素b的previous_entry_length默认是1个字节，无法存储元素a的长度，这就需要往后扩充空间。元素b后面的元素c、d等等也需要一同扩充。")),t[4]||(t[4]=e("strong",null,"效率很低",-1)),t[5]||(t[5]=a(" 。"))]),t[11]||(t[11]=s('<h3 id="listpack" tabindex="-1"><a class="header-anchor" href="#listpack"><span>listpack</span></a></h3><table><thead><tr><th>encoding</th><th>content</th><th>length</th></tr></thead><tbody><tr><td>content的编码属性（字符串还是整数），以及content的长度。占用1个字节。</td><td>本元素节点的数据</td><td>本元素节点的长度</td></tr><tr><td>不再会因为其他元素的变动而影响到本元素节点。</td><td></td><td></td></tr></tbody></table><p>length的目的是为了方便反向遍历，当反向遍历到本节点时，只需要拿反向第一个字节（length的值），就能知道这个元素节点的长度是多少，不需要将这个元素完整遍历完，可直接根据长度跳到下一个元素。</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><table><thead><tr><th>Redis版本</th><th>string</th><th>hash</th><th>list</th><th>set</th><th>zset</th></tr></thead><tbody><tr><td><strong>Redis6</strong></td><td>SDS</td><td>hashtable+ziplist</td><td>quicklist+ziplist</td><td>insert+ziplist+hasstable</td><td>skiplist+ziplist</td></tr><tr><td><strong>Redis7</strong></td><td>SDS</td><td>hashtable+listpack</td><td>quicklist+listpack</td><td>insert+listpack+hasstable</td><td>skiplist+listpack</td></tr></tbody></table><p>当数据量较小时，使用的都是 <code>listpack</code> ，后面数据量上来了，则 <code>hash</code> 会切换为 <code>hashtable</code> ，<code>list</code> 会切换为<code>quicklist</code> ，<code>zset</code> 会切换为 <code>skiplist</code> 。</p><h3 id="skiplist" tabindex="-1"><a class="header-anchor" href="#skiplist"><span>skiplist</span></a></h3><p>skiplist是一种用空间换时间的策略，是多层级索引（每级索引的构建，都是在上一级索引的基础上，进行跳过一个元素的规则），例如</p><p>集合数据：[1、2、3、4、5、6]</p><p>则构建索引如下</p><p>二级索引：1--&gt;5</p><p>一级索引：1--&gt;3--&gt;5</p><p>原始联表：1--&gt;2--&gt;3--&gt;4--&gt;5--&gt;6</p><p>如果要查询6，则是先到二级索引比较，大于5，则直接到原始表里从5开始往后找。</p><p>如果要查询4，则是先到二级索引比较，大于1小于5，则到一级索引比较，大于3，则可直接判定4在原始联表的位置为3之后一个。</p>',15)),e("p",null,[t[8]||(t[8]=a("所以在查询时效率较高，时间复杂度为 O ( ")),e("mjx-container",p,[(n(),i("svg",T,t[6]||(t[6]=[s('<g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" transform="translate(278,0)"></path><path data-c="67" d="M329 409Q373 453 429 453Q459 453 472 434T485 396Q485 382 476 371T449 360Q416 360 412 390Q410 404 415 411Q415 412 416 414V415Q388 412 363 393Q355 388 355 386Q355 385 359 381T368 369T379 351T388 325T392 292Q392 230 343 187T222 143Q172 143 123 171Q112 153 112 133Q112 98 138 81Q147 75 155 75T227 73Q311 72 335 67Q396 58 431 26Q470 -13 470 -72Q470 -139 392 -175Q332 -206 250 -206Q167 -206 107 -175Q29 -140 29 -75Q29 -39 50 -15T92 18L103 24Q67 55 67 108Q67 155 96 193Q52 237 52 292Q52 355 102 398T223 442Q274 442 318 416L329 409ZM299 343Q294 371 273 387T221 404Q192 404 171 388T145 343Q142 326 142 292Q142 248 149 227T179 192Q196 182 222 182Q244 182 260 189T283 207T294 227T299 242Q302 258 302 292T299 343ZM403 -75Q403 -50 389 -34T348 -11T299 -2T245 0H218Q151 0 138 -6Q118 -15 107 -34T95 -74Q95 -84 101 -97T122 -127T170 -155T250 -167Q319 -167 361 -139T403 -75Z" transform="translate(778,0)"></path></g><g data-mml-node="TeXAtom" transform="translate(1311,-241.4) scale(0.707)" data-mjx-texclass="ORD"></g></g><g data-mml-node="mo" transform="translate(1361,0)"><path data-c="2061" d=""></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1527.7,0)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g></g></g>',1)]))),t[7]||(t[7]=e("mjx-assistive-mml",{unselectable:"on",display:"inline"},[e("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[e("msub",null,[e("mi",null,"log"),e("mrow",{"data-mjx-texclass":"ORD"})]),e("mo",{"data-mjx-texclass":"NONE"},"⁡"),e("mrow",{"data-mjx-texclass":"ORD"},[e("mi",null,"n")])])],-1))]),t[9]||(t[9]=a(" ) ，空间复杂度为 O( n ) 。适合读多写少的场景。"))])])}const g=d(l,[["render",h],["__file","index.html.vue"]]),c=JSON.parse('{"path":"/interview/31igfiqg/","title":"Redis常用数据类型的底层数据结构","lang":"zh-CN","frontmatter":{"title":"Redis常用数据类型的底层数据结构","createTime":"2025/09/03 22:28:41","permalink":"/interview/31igfiqg/","description":"redis7由ziplist替换为listpack的原因 ziplist ziplist是由连续内存块组成的顺序性数据结构，整个结构有点类似于数组。可以在任意一端进行push/pop操作时间复杂度都是O(1)。 ziplist这个 \\"数组\\" 的每一个元素节点（entry），就相当于hash数据类型的value里的一个键值对。 entry里分为三个部分 ...","head":[["meta",{"property":"og:url","content":"https://blog.gaohan.asia/interview/31igfiqg/"}],["meta",{"property":"og:site_name","content":"云泽汇码"}],["meta",{"property":"og:title","content":"Redis常用数据类型的底层数据结构"}],["meta",{"property":"og:description","content":"redis7由ziplist替换为listpack的原因 ziplist ziplist是由连续内存块组成的顺序性数据结构，整个结构有点类似于数组。可以在任意一端进行push/pop操作时间复杂度都是O(1)。 ziplist这个 \\"数组\\" 的每一个元素节点（entry），就相当于hash数据类型的value里的一个键值对。 entry里分为三个部分 ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-09-06T01:26:28.000Z"}],["meta",{"property":"article:modified_time","content":"2025-09-06T01:26:28.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Redis常用数据类型的底层数据结构\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-09-06T01:26:28.000Z\\",\\"author\\":[]}"]]},"headers":[],"readingTime":{"minutes":3.03,"words":910},"git":{"updatedTime":1757121988000,"contributors":[{"name":"yunze","username":"yunze","email":"834363368@qq.com","commits":2,"avatar":"https://avatars.githubusercontent.com/yunze?v=4","url":"https://github.com/yunze"}]},"autoDesc":true,"filePathRelative":"notes/interview/2.Redis/9.Redis常用数据类型的底层数据结构.md"}');export{g as comp,c as data};
