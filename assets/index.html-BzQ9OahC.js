import{_ as a,e as n,f as p,o as e}from"./app-Cx_oisp2.js";const i="/assets/image-20251009234218231-Crg5iHja.png",l="/assets/image-20251010165325606-BObYu6t0.png",t="/assets/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B-VLEnzIWx.png",c="/assets/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2-CHmHusAK.png",h={};function d(r,s){return e(),n("div",null,s[0]||(s[0]=[p(`<p>核心线程数 = CPU核数 × (1 + IO等待时间 / CPU时间)</p><p>最大线程数，在核心线程数的基础上加一点点做缓冲即可。</p><p>工作队列（workQueue），只需要缓冲1~3秒的突发QPS流量即可，其余的请求应该触发线程池的拒绝策略</p><h2 id="executors" tabindex="-1"><a class="header-anchor" href="#executors"><span>Executors</span></a></h2><h3 id="代码案例" tabindex="-1"><a class="header-anchor" href="#代码案例"><span>代码案例</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">class</span><span class="space"> </span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">ThreadPoolDemo</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">static</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">void</span><span class="space"> </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">main</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">String</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[]</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">args</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">PayTask</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">task1</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">new</span><span class="space"> </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">PayTask</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">PayTask</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">task2</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">new</span><span class="space"> </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">PayTask</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">PayTask</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">task3</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">new</span><span class="space"> </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">PayTask</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ExecutorService</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">executorService</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">Executors</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">newSingleThreadExecutor</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">executorService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">submit</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">task1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">executorService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">submit</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">task2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">executorService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">submit</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">task3</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">class</span><span class="space"> </span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">PayTask</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">implements</span><span class="space"> </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Runnable</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">@</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Override</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">void</span><span class="space"> </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">System</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">out</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">println</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">Thread</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">currentThread</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">().</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getName</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">+</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">开始执行支付任务...</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果，是同一个线程执行的任务。</p><p><img src="`+i+`" alt="image-20251009234218231"></p><p>Executors提供了各种线程池类型创建的静态方法，</p><p>如常见的newFixedThreadPool、newSingleThreadExecutor、newCachedThreadPool、newSingleThreadScheduledExecutor。</p><hr><h3 id="线程池核心参数与注意事项" tabindex="-1"><a class="header-anchor" href="#线程池核心参数与注意事项"><span>线程池核心参数与注意事项</span></a></h3><table><thead><tr><th style="text-align:left;">线程池方法</th><th style="text-align:left;">核心线程数</th><th style="text-align:left;">最大线程数</th><th style="text-align:left;">工作队列</th><th style="text-align:left;">重要注意事项</th></tr></thead><tbody><tr><td style="text-align:left;"><strong><code>newFixedThreadPool</code></strong></td><td style="text-align:left;"><strong>固定 (nThreads)</strong></td><td style="text-align:left;"><strong>固定 (同核心数)</strong></td><td style="text-align:left;"><code>LinkedBlockingQueue</code> (无界)</td><td style="text-align:left;"><strong>【内存泄漏风险】</strong>：由于使用无界队列，如果任务提交速度持续高于处理速度，可能导致队列无限增长，最终引发 <code>OutOfMemoryError</code>。</td></tr><tr><td style="text-align:left;"><strong><code>newSingleThreadExecutor</code></strong></td><td style="text-align:left;"><strong>1</strong></td><td style="text-align:left;"><strong>1</strong></td><td style="text-align:left;"><code>LinkedBlockingQueue</code> (无界)</td><td style="text-align:left;"><strong>【内存泄漏风险】</strong>：同 <code>FixedThreadPool</code>，因使用无界队列。 如果唯一的线程因异常终止，会创建一个新线程继续执行。</td></tr><tr><td style="text-align:left;"><strong><code>newCachedThreadPool</code></strong></td><td style="text-align:left;"><strong>0</strong></td><td style="text-align:left;"><code>Integer.MAX_VALUE</code></td><td style="text-align:left;"><code>SynchronousQueue</code> (直接传递)</td><td style="text-align:left;"><strong>【资源耗尽风险】</strong>：由于最大线程数几乎是无限的，在任务提交非常频繁且执行时间较长时，可能创建大量线程，耗尽 CPU 和内存资源。</td></tr><tr><td style="text-align:left;"><strong><code>newSingleThreadScheduledExecutor</code></strong></td><td style="text-align:left;"><strong>1</strong></td><td style="text-align:left;"><strong>1</strong></td><td style="text-align:left;"><code>DelayedWorkQueue</code> (无界延迟队列)</td><td style="text-align:left;">1. <strong>【内存泄漏风险】</strong>：无界队列。<br>2. 长任务会延迟后续周期任务。</td></tr><tr><td style="text-align:left;"><strong><code>newScheduledThreadPool</code></strong></td><td style="text-align:left;"><strong>核心池可指定</strong></td><td style="text-align:left;"><code>Integer.MAX_VALUE</code></td><td style="text-align:left;"><code>DelayedWorkQueue</code> (无界延迟队列)</td><td style="text-align:left;"><strong>【内存泄漏风险】</strong>：无界队列。</td></tr></tbody></table><hr><h3 id="线程池特点与应用场景" tabindex="-1"><a class="header-anchor" href="#线程池特点与应用场景"><span>线程池特点与应用场景</span></a></h3><table><thead><tr><th style="text-align:left;">线程池方法</th><th style="text-align:left;">特点</th><th style="text-align:left;">应用场景</th></tr></thead><tbody><tr><td style="text-align:left;"><strong><code>newFixedThreadPool</code></strong></td><td style="text-align:left;">1. 线程数固定，控制最大并发。<br>2. 超出的任务在无界队列中等待。<br>3. 线程空闲也不会被回收。</td><td style="text-align:left;">适用于<strong>负载较重</strong>、需要<strong>限制线程数量</strong>以控制资源消耗的场景。如 Web 服务器处理请求、稳定的周期性任务。</td></tr><tr><td style="text-align:left;"><strong><code>newSingleThreadExecutor</code></strong></td><td style="text-align:left;">1. 保证所有任务<strong>顺序执行</strong>。<br>2. 不存在线程同步问题。<br>3. 唯一的线程。</td><td style="text-align:left;">适用于需要<strong>保证任务顺序执行</strong>的场景。如日志打印、事务性操作、需要单例执行的任务。</td></tr><tr><td style="text-align:left;"><strong><code>newCachedThreadPool</code></strong></td><td style="text-align:left;">1. <strong>弹性扩容</strong>：有任务就创建新线程。<br>2. <strong>自动回收</strong>：线程空闲60秒后终止。<br>3. 响应速度快。</td><td style="text-align:left;">适用于执行<strong>大量短生命周期</strong>的<strong>异步任务</strong>。如 HTTP 请求处理、频繁的轻量级计算。</td></tr><tr><td style="text-align:left;"><strong><code>newSingleThreadScheduledExecutor</code></strong></td><td style="text-align:left;">1. 在单线程基础上，增加了<strong>定时</strong>和<strong>周期性</strong>执行任务的能力。<br>2. 保证所有任务按顺序执行。</td><td style="text-align:left;">适用于需要<strong>单线程</strong>且<strong>定时/周期</strong>执行任务的场景。如后台守护任务、顺序的定时数据同步、心跳检测。</td></tr><tr><td style="text-align:left;"><strong><code>newScheduledThreadPool</code></strong></td><td style="text-align:left;">1. 多线程的定时/周期任务线程池。<br>2. 可并行执行多个定时任务，效率更高。</td><td style="text-align:left;">适用于需要<strong>多个线程</strong>执行<strong>定时或周期性</strong>任务的场景。如多路定时数据采集、并行周期性检查。</td></tr></tbody></table><h3 id="核心总结与最佳实践" tabindex="-1"><a class="header-anchor" href="#核心总结与最佳实践"><span>核心总结与最佳实践</span></a></h3><ol><li><strong>风险警示</strong>：<code>Executors</code> 提供的这几种快捷工厂方法（除 <code>newWorkStealingPool</code> 外）大多使用<strong>无界队列</strong>或<strong>无界线程数</strong>，在生产环境中使用需极其谨慎，容易导致资源耗尽。</li><li><strong>推荐做法</strong>：对于生产环境，<strong>推荐使用 <code>ThreadPoolExecutor</code> 构造函数来手动创建线程池</strong>。这样可以明确指定核心参数（核心线程数、最大线程数、队列类型及容量、拒绝策略等），实现更精细的资源控制和更健壮的服务。</li><li><strong>选择依据</strong>：选择线程池类型的核心在于分析你的任务特性： <ul><li><strong>任务量是否稳定？</strong> -&gt; 稳定用 <code>Fixed</code>，不稳定用 <code>Cached</code>（但要控制风险）。</li><li><strong>是否需要顺序执行？</strong> -&gt; 是，用 <code>SingleThread</code>。</li><li><strong>是否需要定时/周期？</strong> -&gt; 是，用 <code>Scheduled</code>。</li></ul></li></ol><h2 id="threadpoolexecutor" tabindex="-1"><a class="header-anchor" href="#threadpoolexecutor"><span>ThreadPoolExecutor</span></a></h2><h3 id="代码案例-1" tabindex="-1"><a class="header-anchor" href="#代码案例-1"><span>代码案例</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">package</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">com</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">yz</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">base</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">thread</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">P</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ool</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">java</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">util</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">concurrent</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">*</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">/**</span></span>
<span class="line"><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">*</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">@author</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">yunze</span></span>
<span class="line"><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">*</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">@since</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">2025/10/10</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">12:33</span></span>
<span class="line"><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">*/</span></span>
<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">class</span><span class="space"> </span><span style="--shiki-light:#2E8F82;--shiki-dark:#5DA994;">ThreadPoolDemo2</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">static</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">void</span><span class="space"> </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">main</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">String</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">[]</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">args</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">拒绝策略</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">RejectedExecutionHandler</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">policy</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">new</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ThreadPoolExecutor</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">CallerRunsPolicy</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">();</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">等待队列</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ArrayBlockingQueue</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">Runnable</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&gt;</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">queue</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">new</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ArrayBlockingQueue</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">&lt;&gt;(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">核心线程数</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">int</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">corePoolSize</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">3</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">最大线程数</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">int</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">maximumPoolSize</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">线程存活时间</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">long</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">keepAliveTime</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">10</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ThreadPoolExecutor</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">executorService</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">new</span><span class="space"> </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">ThreadPoolExecutor</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">corePoolSize</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">maximumPoolSize</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">keepAliveTime</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">TimeUnit</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">SECONDS</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">queue</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">policy</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">for</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">int</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">i</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">i</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">9</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">;</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">i</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">++</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">//</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">executorService.execute(new</span><span class="space"> </span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">PayTask());</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">executorService</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">execute</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(()</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">-&gt;</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">try</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">Thread</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sleep</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2000</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">catch</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">InterruptedException</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">e</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">{</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">throw</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">new</span><span class="space"> </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">RuntimeException</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">e</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">System</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">out</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">println</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">线程池执行任务：</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">+</span><span class="space"> </span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">Thread</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">currentThread</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">().</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getName</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">());</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">});</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果</p><p><img src="`+l+'" alt="image-20251010165325606"></p><p>提交一个Runnable时，不管当前线程池中的线程是否空闲，只要数量小于核心线程数就会创建新线程。</p><p>好的，这是为您整理的线程池核心参数表格。</p><h3 id="线程池核心参数详解" tabindex="-1"><a class="header-anchor" href="#线程池核心参数详解"><span>线程池核心参数详解</span></a></h3><table><thead><tr><th style="text-align:left;">参数名</th><th style="text-align:left;">说明</th><th style="text-align:left;">补充说明/工作逻辑</th></tr></thead><tbody><tr><td style="text-align:left;"><strong><code>corePoolSize</code></strong></td><td style="text-align:left;">核心线程数</td><td style="text-align:left;">线程池初始化时默认没有线程，任务来临时才开始创建。即使线程空闲，也会保留在池中。</td></tr><tr><td style="text-align:left;"><strong><code>maximumPoolSize</code></strong></td><td style="text-align:left;">最大线程数</td><td style="text-align:left;">核心线程已满 <strong>且</strong> 工作队列已满时，才会创建非核心线程，且总数不能超过此值。</td></tr><tr><td style="text-align:left;"><strong><code>keepAliveTime</code></strong></td><td style="text-align:left;">非核心线程空闲存活时间</td><td style="text-align:left;">非核心线程空闲时间超过此值会被终止回收。当 <code>corePoolSize</code> = <code>maximumPoolSize</code> 时，此参数无效。</td></tr><tr><td style="text-align:left;"><strong><code>unit</code></strong></td><td style="text-align:left;"><code>keepAliveTime</code> 的时间单位</td><td style="text-align:left;">如 <code>TimeUnit.SECONDS</code>、<code>TimeUnit.MILLISECONDS</code>。</td></tr><tr><td style="text-align:left;"><strong><code>workQueue</code></strong></td><td style="text-align:left;">任务队列</td><td style="text-align:left;">用于保存等待执行的任务。当工作线程数 &gt;= <code>corePoolSize</code> 时，新任务会进入此队列。</td></tr><tr><td style="text-align:left;"><strong><code>threadFactory</code></strong></td><td style="text-align:left;">线程工厂</td><td style="text-align:left;">用于创建新线程。默认使用 <code>Executors.defaultThreadFactory()</code>。可自定义以实现线程命名、优先级等。</td></tr><tr><td style="text-align:left;"><strong><code>handler</code></strong></td><td style="text-align:left;">拒绝策略</td><td style="text-align:left;">当线程池已关闭，或 <code>workQueue</code> 和 <code>maximumPoolSize</code> 都已满时，对新任务采取的处理策略。</td></tr></tbody></table><hr><h3 id="工作队列-workqueue-类型对比" tabindex="-1"><a class="header-anchor" href="#工作队列-workqueue-类型对比"><span>工作队列 (<code>workQueue</code>) 类型对比</span></a></h3><table><thead><tr><th style="text-align:left;">队列类型</th><th style="text-align:left;">特点</th><th style="text-align:left;">可能产生的问题</th></tr></thead><tbody><tr><td style="text-align:left;"><strong><code>ArrayBlockingQueue</code></strong><br>(有界队列)</td><td style="text-align:left;">队列长度固定。队列满后，会创建非核心线程，若线程数已达上限则触发拒绝策略。</td><td style="text-align:left;">需要合理设置队列大小，否则容易触发拒绝策略。</td></tr><tr><td style="text-align:left;"><strong><code>LinkedBlockingQueue</code></strong><br>(无界队列)</td><td style="text-align:left;">队列长度理论无限（容量为 <code>Integer.MAX_VALUE</code>）。任务处理跟不上创建速度时，队列会持续增长。</td><td style="text-align:left;">可能导致内存占用过多，最终引发 <strong>OutOfMemoryError (OOM)</strong>。</td></tr><tr><td style="text-align:left;"><strong><code>SynchronousQueue</code></strong><br>(同步移交队列)</td><td style="text-align:left;">不存储任务，队列长度为0。每个插入操作必须等待另一个线程的移除操作。</td><td style="text-align:left;">任务无法缓冲，若无空闲线程接收则会立即尝试创建新线程，易触及最大线程数上限。</td></tr></tbody></table><hr><h3 id="拒绝策略-handler-对比" tabindex="-1"><a class="header-anchor" href="#拒绝策略-handler-对比"><span>拒绝策略 (<code>handler</code>) 对比</span></a></h3><table><thead><tr><th style="text-align:left;">拒绝策略</th><th style="text-align:left;">行为</th><th style="text-align:left;">适用场景</th></tr></thead><tbody><tr><td style="text-align:left;"><strong><code>AbortPolicy</code></strong><br>(默认)</td><td style="text-align:left;">抛出 <strong><code>RejectedExecutionException</code></strong> 异常，中断任务提交。</td><td style="text-align:left;">需要明确感知任务被拒绝的场景，便于快速失败和问题排查。</td></tr><tr><td style="text-align:left;"><strong><code>CallerRunsPolicy</code></strong></td><td style="text-align:left;">让<strong>提交任务的主线程</strong>自己来执行该任务。</td><td style="text-align:left;">一种温和的负反馈机制，让提交方也承担压力，从而自然降低提交速度。</td></tr><tr><td style="text-align:left;"><strong><code>DiscardOldestPolicy</code></strong></td><td style="text-align:left;"><strong>丢弃队列中存在最久</strong>的任务，然后重新尝试提交当前任务。</td><td style="text-align:left;">允许丢弃旧任务以尝试执行新任务，但可能丢失重要历史任务。</td></tr><tr><td style="text-align:left;"><strong><code>DiscardPolicy</code></strong></td><td style="text-align:left;">直接<strong>丢弃</strong>新提交的任务，<strong>不抛出任何异常</strong>。</td><td style="text-align:left;">允许无声丢失任务的场景，风险在于问题被掩盖。</td></tr><tr><td style="text-align:left;"><strong>自定义策略</strong></td><td style="text-align:left;">实现 <code>RejectedExecutionHandler</code> 接口，根据业务需求自定义（如记录日志、持久化任务等）。</td><td style="text-align:left;">需要更复杂或特定拒绝逻辑的高阶场景。</td></tr></tbody></table><h2 id="线程池的工作流程" tabindex="-1"><a class="header-anchor" href="#线程池的工作流程"><span>线程池的工作流程</span></a></h2><p><img src="'+t+'" alt="线程池工作流程"></p><h2 id="线程池的状态" tabindex="-1"><a class="header-anchor" href="#线程池的状态"><span>线程池的状态</span></a></h2><h3 id="线程池生命周期状态转换" tabindex="-1"><a class="header-anchor" href="#线程池生命周期状态转换"><span>线程池生命周期状态转换</span></a></h3><table><thead><tr><th style="text-align:left;">状态转换</th><th style="text-align:left;">触发条件</th><th style="text-align:left;">说明与细节</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>RUNNING -&gt; SHUTDOWN</strong></td><td style="text-align:left;">手动调用 <code>shutdown()</code> 方法触发。</td><td style="text-align:left;">1. 这是<strong>优雅关闭</strong>的起点。<br>2. 线程池对象被 GC 时，会在 <code>finalize()</code> 方法中调用 <code>shutdown()</code>，但<strong>不推荐</strong>依赖此行为。</td></tr><tr><td style="text-align:left;"><strong>(RUNNING or SHUTDOWN) -&gt; STOP</strong></td><td style="text-align:left;">手动调用 <code>shutdownNow()</code> 方法触发。</td><td style="text-align:left;">1. 这是<strong>强制关闭</strong>的起点。<br>2. 如果先调用 <code>shutdown()</code> 紧接着调用 <code>shutdownNow()</code>，就会发生 <strong>SHUTDOWN -&gt; STOP</strong> 的转换。</td></tr><tr><td style="text-align:left;"><strong>SHUTDOWN -&gt; TIDYING</strong></td><td style="text-align:left;"><strong>任务队列为空</strong> <strong>并且</strong> <strong>线程池中工作线程数为0</strong> 时自动转换。</td><td style="text-align:left;">这是优雅关闭的清理准备阶段，表示所有已提交的任务都已执行完毕。</td></tr><tr><td style="text-align:left;"><strong>STOP -&gt; TIDYING</strong></td><td style="text-align:left;"><strong>线程池中工作线程数为0</strong> 时自动转换。</td><td style="text-align:left;">进入此状态<strong>不要求任务队列为空</strong>，因为 <code>shutdownNow()</code> 会尝试中断 worker 并清空队列，队列中可能还有未处理的任务。</td></tr><tr><td style="text-align:left;"><strong>TIDYING -&gt; TERMINATED</strong></td><td style="text-align:left;"><code>terminated()</code> 钩子方法执行完毕后自动转换。</td><td style="text-align:left;">1. 这是线程池的<strong>最终状态</strong>。<br>2. 开发者可以重写 <code>terminated()</code> 方法，在线程池完全结束前执行自定义的清理或日志记录操作。</td></tr></tbody></table><hr><h3 id="核心状态说明" tabindex="-1"><a class="header-anchor" href="#核心状态说明"><span>核心状态说明</span></a></h3><ul><li><strong>RUNNING</strong>：能接收新任务，并能处理已提交的任务。</li><li><strong>SHUTDOWN</strong>：<strong>不再接收新任务</strong>，但会处理完<strong>工作队列中已存在</strong>的任务。</li><li><strong>STOP</strong>：<strong>不再接收新任务</strong>，也<strong>不再处理队列中的任务</strong>，并会尝试<strong>中断所有正在执行的任务</strong>。</li><li><strong>TIDYING</strong>：过渡状态，所有任务都已终止，工作线程数为0。即将执行 <code>terminated()</code> 钩子。</li><li><strong>TERMINATED</strong>：<code>terminated()</code> 方法已执行完毕，线程池彻底关闭。</li></ul><h3 id="示意图" tabindex="-1"><a class="header-anchor" href="#示意图"><span>示意图</span></a></h3><p><img src="'+c+'" alt="线程池状态转换"></p><h2 id="线程池调优注意事项" tabindex="-1"><a class="header-anchor" href="#线程池调优注意事项"><span>线程池调优注意事项</span></a></h2><p>workQueue工作队列不适合设置过大，否则，工作队列不放满，就不会去创建非核心线程，任务的处理速度就快不起来，会一直慢吞吞的处理。 所以需要根据任务的产生数量和线程处理任务的效率，综合评估工作队列的大小。</p>',45)]))}const g=a(h,[["render",d],["__file","index.html.vue"]]),o=JSON.parse('{"path":"/interview/j1noysps/","title":"线程池ThreadPoolExecutor实战及原理","lang":"zh-CN","frontmatter":{"title":"线程池ThreadPoolExecutor实战及原理","createTime":"2025/10/09 23:28:44","permalink":"/interview/j1noysps/","tags":["并发","线程池"],"description":"核心线程数 = CPU核数 × (1 + IO等待时间 / CPU时间) 最大线程数，在核心线程数的基础上加一点点做缓冲即可。 工作队列（workQueue），只需要缓冲1~3秒的突发QPS流量即可，其余的请求应该触发线程池的拒绝策略 Executors 代码案例 运行结果，是同一个线程执行的任务。 image-20251009234218231 Ex...","head":[["meta",{"property":"og:url","content":"https://blog.gaohan.asia/interview/j1noysps/"}],["meta",{"property":"og:site_name","content":"云泽汇码"}],["meta",{"property":"og:title","content":"线程池ThreadPoolExecutor实战及原理"}],["meta",{"property":"og:description","content":"核心线程数 = CPU核数 × (1 + IO等待时间 / CPU时间) 最大线程数，在核心线程数的基础上加一点点做缓冲即可。 工作队列（workQueue），只需要缓冲1~3秒的突发QPS流量即可，其余的请求应该触发线程池的拒绝策略 Executors 代码案例 运行结果，是同一个线程执行的任务。 image-20251009234218231 Ex..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-10-26T12:40:27.000Z"}],["meta",{"property":"article:tag","content":"并发"}],["meta",{"property":"article:tag","content":"线程池"}],["meta",{"property":"article:modified_time","content":"2025-10-26T12:40:27.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"线程池ThreadPoolExecutor实战及原理\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-10-26T12:40:27.000Z\\",\\"author\\":[]}"]]},"headers":[],"readingTime":{"minutes":8.37,"words":2511},"git":{"updatedTime":1761482427000,"contributors":[{"name":"yunze","username":"yunze","email":"834363368@qq.com","commits":1,"avatar":"https://avatars.githubusercontent.com/yunze?v=4","url":"https://github.com/yunze"}]},"autoDesc":true,"filePathRelative":"notes/interview/5.Concurrent/5.线程池ThreadPoolExecutor实战及原理.md"}');export{g as comp,o as data};
