<!doctype html><html lang="zh-CN"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><meta name="generator" content="VuePress 2.0.0-rc.20" /><meta name="theme" content="VuePress Theme Plume " /><script id="check-mac-os">document.documentElement.classList.toggle('mac', /Mac|iPhone|iPod|iPad/i.test(navigator.platform))</script><script id="check-dark-mode">;(function () {const um= localStorage.getItem('vuepress-theme-appearance') || 'auto';const sm = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;const isDark = um === 'dark' || (um !== 'light' && sm);document.documentElement.dataset.theme = isDark ? 'dark' : 'light';})();</script><meta property="og:url" content="https://blog.gaohan.asia/article/2bal0wvr/"><meta property="og:site_name" content="云泽汇码"><meta property="og:title" content="MySQL主从集群配置"><meta property="og:description" content="MySQL服务的主从架构是通过binlog日志文件来实现的。使用MySQL做读写分离配置时，就必须基于主从架构来搭建，主节点用来写入数据，从节点用来读取数据。 在主服务节点上开启binlog日志，用来记录每一步数据库的操作。 然后在从服务节点上，就会有一个IO线程，负责跟主服务建立一个TCP连接，用来请求主服务，获取最新的binlog日志。 主服务节点..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-03-11T09:46:08.000Z"><meta property="article:tag" content="手册"><meta property="article:tag" content="数据库"><meta property="article:tag" content="MySQL"><meta property="article:tag" content="主从"><meta property="article:modified_time" content="2025-03-11T09:46:08.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"MySQL主从集群配置","image":[""],"dateModified":"2025-03-11T09:46:08.000Z","author":[]}</script><link rel="icon" type="images/png" href="https://blog.gaohan.asia/plume.png"><meta name="msvalidate.01" content="0508C8F9658C27122ABCB4C8941A68F7"><meta name="algolia-site-verification" content="8FA462C6B921A60E"><script>
          var _hmt = _hmt || [];
          (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?6271af65cdb8a84803fa4410d26c0764";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
          })();
      </script><title>MySQL主从集群配置 | 云泽汇码</title><meta name="description" content="MySQL服务的主从架构是通过binlog日志文件来实现的。使用MySQL做读写分离配置时，就必须基于主从架构来搭建，主节点用来写入数据，从节点用来读取数据。 在主服务节点上开启binlog日志，用来记录每一步数据库的操作。 然后在从服务节点上，就会有一个IO线程，负责跟主服务建立一个TCP连接，用来请求主服务，获取最新的binlog日志。 主服务节点..."><link rel="preload" href="/assets/style-BECUVKJa.css" as="style"><link rel="stylesheet" href="/assets/style-BECUVKJa.css"><link rel="modulepreload" href="/assets/app-Cx_oisp2.js"><link rel="modulepreload" href="/assets/index.html-BOtXHWuS.js"></head><body><div id="app"><!--[--><!--[--><div class="theme-plume vp-layout" vp-container data-v-0f45c45d><!--[--><!--[--><!--]--><!--[--><span tabindex="-1" data-v-be5bdb30></span><a href="#VPContent" class="vp-skip-link visually-hidden" data-v-be5bdb30> Skip to content </a><!--]--><!----><header class="vp-nav" data-v-0f45c45d data-v-fa6bad2d><div class="vp-navbar" vp-navbar data-v-fa6bad2d data-v-b88a6553><div class="wrapper" data-v-b88a6553><div class="container" data-v-b88a6553><div class="title" data-v-b88a6553><div class="vp-navbar-title" data-v-b88a6553 data-v-9c0ce884><a class="vp-link no-icon link title" href="/" data-v-9c0ce884 data-v-3a9f60f0><!--[--><!--[--><!--]--><!--[--><!--[--><!--[--><img class="vp-image dark logo" style="" src="/images/plume.png" alt data-v-efba2409><!--]--><!--[--><img class="vp-image light logo" style="" src="/images/plume.png" alt data-v-efba2409><!--]--><!--]--><!--]--><span data-v-9c0ce884>云泽汇码</span><!--[--><!--]--><!--]--><!----></a></div></div><div class="content" data-v-b88a6553><div class="content-body" data-v-b88a6553><!--[--><!--]--><div class="vp-navbar-search search" data-v-b88a6553><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="vp-navbar-menu menu" data-v-b88a6553 data-v-eaf94c84><span id="main-nav-aria-label" class="visually-hidden" data-v-eaf94c84>Main Navigation</span><!--[--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/" tabindex="0" data-v-eaf94c84 data-v-cd753c8b data-v-3a9f60f0><!--[--><!----><span data-v-cd753c8b>首页</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/" tabindex="0" data-v-eaf94c84 data-v-cd753c8b data-v-3a9f60f0><!--[--><!----><span data-v-cd753c8b>博客</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/interview/" tabindex="0" data-v-eaf94c84 data-v-cd753c8b data-v-3a9f60f0><!--[--><!----><span data-v-cd753c8b>专题训练</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/tags/" tabindex="0" data-v-eaf94c84 data-v-cd753c8b data-v-3a9f60f0><!--[--><!----><span data-v-cd753c8b>标签</span><!--]--><!----></a><!--]--><!--[--><a class="vp-link no-icon link navbar-menu-link" href="/blog/archives/" tabindex="0" data-v-eaf94c84 data-v-cd753c8b data-v-3a9f60f0><!--[--><!----><span data-v-cd753c8b>归档</span><!--]--><!----></a><!--]--><!--[--><div class="vp-flyout vp-navbar-menu-group" data-v-eaf94c84 data-v-e23f201b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-e23f201b><span class="text" data-v-e23f201b><!----><!----><span data-v-e23f201b>笔记</span><span class="vpi-chevron-down text-icon" data-v-e23f201b></span></span></button><div class="menu" data-v-e23f201b><div class="vp-menu" data-v-e23f201b data-v-7c4f1a3f><div class="items" data-v-7c4f1a3f><!--[--><!--[--><div class="vp-menu-link" data-v-7c4f1a3f data-v-47e78924><a class="vp-link no-icon link" href="/postgraduate/" data-v-47e78924 data-v-3a9f60f0><!--[--><!----> 考研<!--]--><!----></a></div><!--]--><!--[--><div class="vp-menu-link" data-v-7c4f1a3f data-v-47e78924><a class="vp-link no-icon link" href="/article/4o99lto5/" data-v-47e78924 data-v-3a9f60f0><!--[--><!----> 友情链接<!--]--><!----></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="vp-navbar-appearance appearance" data-v-b88a6553 data-v-e723d79c><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-e723d79c data-v-4f56f7d2 data-v-9546dcf7><span class="check" data-v-9546dcf7><span class="icon" data-v-9546dcf7><!--[--><span class="vpi-sun sun" data-v-4f56f7d2></span><span class="vpi-moon moon" data-v-4f56f7d2></span><!--]--></span></span></button></div><div class="vp-social-links vp-navbar-social-links social-links" data-v-b88a6553 data-v-0cd2c7bd data-v-95a4d926><!--[--><a class="vp-social-link no-icon" href="https://github.com/codeyunze" aria-label="github" target="_blank" rel="noopener" data-v-95a4d926 data-v-86a99ffc><span class="vpi-social-github" /></a><!--]--></div><div class="vp-flyout vp-navbar-extra extra" data-v-b88a6553 data-v-6f16644d data-v-e23f201b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-e23f201b><span class="vpi-more-horizontal icon" data-v-e23f201b></span></button><div class="menu" data-v-e23f201b><div class="vp-menu" data-v-e23f201b data-v-7c4f1a3f><!----><!--[--><!--[--><!----><div class="group" data-v-6f16644d><div class="item appearance" data-v-6f16644d><p class="label" data-v-6f16644d>外观</p><div class="appearance-action" data-v-6f16644d><button class="vp-switch vp-switch-appearance" type="button" role="switch" title aria-checked="false" data-v-6f16644d data-v-4f56f7d2 data-v-9546dcf7><span class="check" data-v-9546dcf7><span class="icon" data-v-9546dcf7><!--[--><span class="vpi-sun sun" data-v-4f56f7d2></span><span class="vpi-moon moon" data-v-4f56f7d2></span><!--]--></span></span></button></div></div></div><div class="group" data-v-6f16644d><div class="item social-links" data-v-6f16644d><div class="vp-social-links social-links-list" data-v-6f16644d data-v-95a4d926><!--[--><a class="vp-social-link no-icon" href="https://github.com/codeyunze" aria-label="github" target="_blank" rel="noopener" data-v-95a4d926 data-v-86a99ffc><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="vp-navbar-hamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="nav-screen" data-v-b88a6553 data-v-ace2769d><span class="container" data-v-ace2769d><span class="top" data-v-ace2769d></span><span class="middle" data-v-ace2769d></span><span class="bottom" data-v-ace2769d></span></span></button></div></div></div></div><div class="divider" data-v-b88a6553><div class="divider-line" data-v-b88a6553></div></div></div><!----></header><div class="vp-local-nav fixed reached-top is-blog" data-v-0f45c45d data-v-8b0b44b7><button class="hidden menu" disabled aria-expanded="false" aria-controls="SidebarNav" data-v-8b0b44b7><span class="vpi-align-left menu-icon" data-v-8b0b44b7></span><span class="menu-text" data-v-8b0b44b7>Menu</span></button><div class="vp-local-nav-outline-dropdown" style="--vp-vh:0px;" data-v-8b0b44b7 data-v-5b5c1d2a><button data-v-5b5c1d2a>返回顶部</button><!----></div></div><!----><!--[--><div id="VPContent" vp-content class="vp-content" data-v-0f45c45d data-v-334cc006><div class="vp-doc-container is-blog" data-v-334cc006 data-v-d52aff32><!--[--><!--]--><div class="container" data-v-d52aff32><!----><div class="content" data-v-d52aff32><div class="content-container" data-v-d52aff32><!--[--><!--]--><main class="main" data-v-d52aff32><nav class="vp-breadcrumb" data-v-d52aff32 data-v-73f3b3f3><ol vocab="https://schema.org/" typeof="BreadcrumbList" data-v-73f3b3f3><!--[--><li property="itemListElement" typeof="ListItem" data-v-73f3b3f3><a class="vp-link no-icon link breadcrumb" href="/" property="item" typeof="WebPage" data-v-73f3b3f3 data-v-3a9f60f0><!--[-->首页<!--]--><!----></a><span class="vpi-chevron-right" data-v-73f3b3f3></span><meta property="name" content="首页" data-v-73f3b3f3><meta property="position" content="1" data-v-73f3b3f3></li><li property="itemListElement" typeof="ListItem" data-v-73f3b3f3><a class="vp-link no-icon link breadcrumb" href="/blog/" property="item" typeof="WebPage" data-v-73f3b3f3 data-v-3a9f60f0><!--[-->博客<!--]--><!----></a><span class="vpi-chevron-right" data-v-73f3b3f3></span><meta property="name" content="博客" data-v-73f3b3f3><meta property="position" content="2" data-v-73f3b3f3></li><li property="itemListElement" typeof="ListItem" data-v-73f3b3f3><a class="vp-link no-icon link breadcrumb" href="/blog/categories/?id=11e0ee" property="item" typeof="WebPage" data-v-73f3b3f3 data-v-3a9f60f0><!--[-->database<!--]--><!----></a><span class="vpi-chevron-right" data-v-73f3b3f3></span><meta property="name" content="database" data-v-73f3b3f3><meta property="position" content="3" data-v-73f3b3f3></li><li property="itemListElement" typeof="ListItem" data-v-73f3b3f3><a class="vp-link no-icon link breadcrumb current" href="/article/2bal0wvr/" property="item" typeof="WebPage" data-v-73f3b3f3 data-v-3a9f60f0><!--[-->MySQL主从集群配置<!--]--><!----></a><!----><meta property="name" content="MySQL主从集群配置" data-v-73f3b3f3><meta property="position" content="4" data-v-73f3b3f3></li><!--]--></ol></nav><!--[--><h1 class="vp-doc-title page-title" data-v-6a747cbd>MySQL主从集群配置 <!----></h1><div class="vp-doc-meta" data-v-6a747cbd><p class="reading-time" data-v-6a747cbd><span class="vpi-books icon" data-v-6a747cbd></span><span data-v-6a747cbd>约 1984 字</span><span data-v-6a747cbd>大约 7 分钟</span></p><p data-v-6a747cbd><span class="vpi-tag icon" data-v-6a747cbd></span><!--[--><a class="vp-link no-icon link tag vp-tag-odfu" href="/blog/tags/?tag=手册" data-v-6a747cbd data-v-3a9f60f0><!--[-->手册<!--]--><!----></a><a class="vp-link no-icon link tag vp-tag-zxlu" href="/blog/tags/?tag=数据库" data-v-6a747cbd data-v-3a9f60f0><!--[-->数据库<!--]--><!----></a><a class="vp-link no-icon link tag vp-tag-dpvl" href="/blog/tags/?tag=MySQL" data-v-6a747cbd data-v-3a9f60f0><!--[-->MySQL<!--]--><!----></a><a class="vp-link no-icon link tag vp-tag-k5tw" href="/blog/tags/?tag=主从" data-v-6a747cbd data-v-3a9f60f0><!--[-->主从<!--]--><!----></a><!--]--></p><p class="create-time" data-v-6a747cbd><span class="vpi-clock icon" data-v-6a747cbd></span><span data-v-6a747cbd>2024-04-01</span></p></div><!--]--><div class="_article_2bal0wvr_ external-link-icon-enabled vp-doc plume-content" vp-content data-v-d52aff32><div data-v-d52aff32><p>MySQL服务的主从架构是通过binlog日志文件来实现的。使用MySQL做读写分离配置时，就必须基于主从架构来搭建，主节点用来写入数据，从节点用来读取数据。</p><ol><li>在主服务节点上开启binlog日志，用来记录每一步数据库的操作。</li><li>然后在从服务节点上，就会有一个IO线程，负责跟主服务建立一个TCP连接，用来请求主服务，获取最新的binlog日志。</li><li>主服务节点上会有一个IO dump线程，专门负责讲binlog日志传输给从节点服务。</li><li>接着从节点服务的IO线程会把读取到的binlog日志数据写入自己的relay日志文件中。</li><li>然后从节点服务上另外一个线程会读取relay日志里的内容，进行操作重演，达到数据还原的目的。</li></ol><h1 id="mysql主从集群配置" tabindex="-1"><a class="header-anchor" href="#mysql主从集群配置"><span>MySQL主从集群配置</span></a></h1><h2 id="先安装单机版mysql数据库" tabindex="-1"><a class="header-anchor" href="#先安装单机版mysql数据库"><span>先安装单机版mysql数据库</span></a></h2><p>操作流程： <a class="route-link" href="/article/k5ldy48q/">MySQL数据库安装部署</a></p><h2 id="单机版改造为主从模式" tabindex="-1"><a class="header-anchor" href="#单机版改造为主从模式"><span>单机版改造为主从模式</span></a></h2><h3 id="主节点" tabindex="-1"><a class="header-anchor" href="#主节点"><span>主节点</span></a></h3><h4 id="master主节点服务的my-cnf配置" tabindex="-1"><a class="header-anchor" href="#master主节点服务的my-cnf配置"><span>master主节点服务的my.cnf配置</span></a></h4><div class="language- line-numbers-mode" data-ext="" data-title=""><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>#</span><span class="space"> </span><span>For</span><span class="space"> </span><span>advice</span><span class="space"> </span><span>on</span><span class="space"> </span><span>how</span><span class="space"> </span><span>to</span><span class="space"> </span><span>change</span><span class="space"> </span><span>settings</span><span class="space"> </span><span>please</span><span class="space"> </span><span>see</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>http://dev.mysql.com/doc/refman/8.0/en/server-configuration-defaults.html</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[mysqld]</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>主库需要和从库不一致</span></span>
<span class="line"><span>server-id=47</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>开启binlog日志</span></span>
<span class="line"><span>log_bin=master-bin</span></span>
<span class="line"><span>log_bin-index=master-bin.index</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>设置服务连接端口</span></span>
<span class="line"><span>port=3306</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>跳过域名解析，只接受客户端使用ip地址进行认证</span></span>
<span class="line"><span>skip-name-resolve</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>Remove</span><span class="space"> </span><span>leading</span><span class="space"> </span><span>#</span><span class="space"> </span><span>and</span><span class="space"> </span><span>set</span><span class="space"> </span><span>to</span><span class="space"> </span><span>the</span><span class="space"> </span><span>amount</span><span class="space"> </span><span>of</span><span class="space"> </span><span>RAM</span><span class="space"> </span><span>for</span><span class="space"> </span><span>the</span><span class="space"> </span><span>most</span><span class="space"> </span><span>important</span><span class="space"> </span><span>data</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>cache</span><span class="space"> </span><span>in</span><span class="space"> </span><span>MySQL.</span><span class="space"> </span><span>Start</span><span class="space"> </span><span>at</span><span class="space"> </span><span>70%</span><span class="space"> </span><span>of</span><span class="space"> </span><span>total</span><span class="space"> </span><span>RAM</span><span class="space"> </span><span>for</span><span class="space"> </span><span>dedicated</span><span class="space"> </span><span>server,</span><span class="space"> </span><span>else</span><span class="space"> </span><span>10%.</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>innodb_buffer_pool_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>128M</span></span>
<span class="line"><span>innodb_buffer_pool_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>1024M</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>Remove</span><span class="space"> </span><span>the</span><span class="space"> </span><span>leading</span><span class="space"> </span><span>&quot;#</span><span class="space"> </span><span>&quot;</span><span class="space"> </span><span>to</span><span class="space"> </span><span>disable</span><span class="space"> </span><span>binary</span><span class="space"> </span><span>logging</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>Binary</span><span class="space"> </span><span>logging</span><span class="space"> </span><span>captures</span><span class="space"> </span><span>changes</span><span class="space"> </span><span>between</span><span class="space"> </span><span>backups</span><span class="space"> </span><span>and</span><span class="space"> </span><span>is</span><span class="space"> </span><span>enabled</span><span class="space"> </span><span>by</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>default.</span><span class="space"> </span><span>It&#39;s</span><span class="space"> </span><span>default</span><span class="space"> </span><span>setting</span><span class="space"> </span><span>is</span><span class="space"> </span><span>log_bin=binlog</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>disable_log_bin</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>Remove</span><span class="space"> </span><span>leading</span><span class="space"> </span><span>#</span><span class="space"> </span><span>to</span><span class="space"> </span><span>set</span><span class="space"> </span><span>options</span><span class="space"> </span><span>mainly</span><span class="space"> </span><span>useful</span><span class="space"> </span><span>for</span><span class="space"> </span><span>reporting</span><span class="space"> </span><span>servers.</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>The</span><span class="space"> </span><span>server</span><span class="space"> </span><span>defaults</span><span class="space"> </span><span>are</span><span class="space"> </span><span>faster</span><span class="space"> </span><span>for</span><span class="space"> </span><span>transactions</span><span class="space"> </span><span>and</span><span class="space"> </span><span>fast</span><span class="space"> </span><span>SELECTs.</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>Adjust</span><span class="space"> </span><span>sizes</span><span class="space"> </span><span>as</span><span class="space"> </span><span>needed,</span><span class="space"> </span><span>experiment</span><span class="space"> </span><span>to</span><span class="space"> </span><span>find</span><span class="space"> </span><span>the</span><span class="space"> </span><span>optimal</span><span class="space"> </span><span>values.</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>join_buffer_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>128M</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>sort_buffer_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>2M</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>read_rnd_buffer_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>2M</span></span>
<span class="line"><span>join_buffer_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>256KB</span></span>
<span class="line"><span>sort_buffer_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>512KB</span></span>
<span class="line"><span>read_rnd_buffer_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>256KB</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>Remove</span><span class="space"> </span><span>leading</span><span class="space"> </span><span>#</span><span class="space"> </span><span>to</span><span class="space"> </span><span>revert</span><span class="space"> </span><span>to</span><span class="space"> </span><span>previous</span><span class="space"> </span><span>value</span><span class="space"> </span><span>for</span><span class="space"> </span><span>default_authentication_plugin,</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>this</span><span class="space"> </span><span>will</span><span class="space"> </span><span>increase</span><span class="space"> </span><span>compatibility</span><span class="space"> </span><span>with</span><span class="space"> </span><span>older</span><span class="space"> </span><span>clients.</span><span class="space"> </span><span>For</span><span class="space"> </span><span>background,</span><span class="space"> </span><span>see:</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_default_authentication_plugin</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>default-authentication-plugin=mysql_native_password</span></span>
<span class="line"><span></span></span>
<span class="line"><span>datadir=/var/lib/mysql</span></span>
<span class="line"><span>socket=/var/lib/mysql/mysql.sock</span></span>
<span class="line"><span></span></span>
<span class="line"><span>log-error=/var/log/mysqld.log</span></span>
<span class="line"><span>pid-file=/var/run/mysqld/mysqld.pid</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#</span><span class="space"> </span><span>允许最大连接数</span></span>
<span class="line"><span>max_connections=200</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>允许连接失败的次数。这是为了防止有人从该主机试图攻击数据库系统</span></span>
<span class="line"><span>max_connect_errors=10</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>服务端使用的字符集默认为UTF8</span></span>
<span class="line"><span>character-set-server=utf8</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="启动主节点的mysql服务" tabindex="-1"><a class="header-anchor" href="#启动主节点的mysql服务"><span>启动主节点的mysql服务</span></a></h4><p>启动服务命令</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">service</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mysqld</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">restart</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>重启服务命令</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">service</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mysqld</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">start</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查看服务状态</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">service</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mysqld</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">status</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="master-主节点相关命令" tabindex="-1"><a class="header-anchor" href="#master-主节点相关命令"><span>master 主节点相关命令</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">#</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">查看主节点信息</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">show</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">master</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">status</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">#</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">创建指定用户</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">create</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">user</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&#39;</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">replication_user</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">&#39;@</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">identified</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">by</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">acd5432</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">#</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">授予指定用户复制所有数据库和表的相关操作（一般用于主从复制）</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">grant</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">replication</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">slave</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">on</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">*</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">to</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">replication_user</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">@</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">%</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">#</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">刷新权限以确保立即生效</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">flush</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">privileges</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="从节点" tabindex="-1"><a class="header-anchor" href="#从节点"><span>从节点</span></a></h3><h4 id="slave从节点服务的my-cnf配置" tabindex="-1"><a class="header-anchor" href="#slave从节点服务的my-cnf配置"><span>slave从节点服务的my.cnf配置</span></a></h4><div class="language-cnf line-numbers-mode" data-ext="cnf" data-title="cnf"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>[mysqld]</span></span>
<span class="line"><span>#主库和从库要不一致</span></span>
<span class="line"><span>server-id=48</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>打开MySQL中继日志</span></span>
<span class="line"><span>relay-log-index=slave-relay-bin.index</span></span>
<span class="line"><span>relay-log=slave-relay-bin</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>打开从服务二进制日志</span></span>
<span class="line"><span>log-bin=mysql-bin</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span>log-slave-updates=1</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span>port=3306</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>Remove</span><span class="space"> </span><span>leading</span><span class="space"> </span><span>#</span><span class="space"> </span><span>and</span><span class="space"> </span><span>set</span><span class="space"> </span><span>to</span><span class="space"> </span><span>the</span><span class="space"> </span><span>amount</span><span class="space"> </span><span>of</span><span class="space"> </span><span>RAM</span><span class="space"> </span><span>for</span><span class="space"> </span><span>the</span><span class="space"> </span><span>most</span><span class="space"> </span><span>important</span><span class="space"> </span><span>data</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>cache</span><span class="space"> </span><span>in</span><span class="space"> </span><span>MySQL.</span><span class="space"> </span><span>Start</span><span class="space"> </span><span>at</span><span class="space"> </span><span>70%</span><span class="space"> </span><span>of</span><span class="space"> </span><span>total</span><span class="space"> </span><span>RAM</span><span class="space"> </span><span>for</span><span class="space"> </span><span>dedicated</span><span class="space"> </span><span>server,</span><span class="space"> </span><span>else</span><span class="space"> </span><span>10%.</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>innodb_buffer_pool_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>128M</span></span>
<span class="line"><span>innodb_buffer_pool_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>512M</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>Remove</span><span class="space"> </span><span>the</span><span class="space"> </span><span>leading</span><span class="space"> </span><span>&quot;#</span><span class="space"> </span><span>&quot;</span><span class="space"> </span><span>to</span><span class="space"> </span><span>disable</span><span class="space"> </span><span>binary</span><span class="space"> </span><span>logging</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>Binary</span><span class="space"> </span><span>logging</span><span class="space"> </span><span>captures</span><span class="space"> </span><span>changes</span><span class="space"> </span><span>between</span><span class="space"> </span><span>backups</span><span class="space"> </span><span>and</span><span class="space"> </span><span>is</span><span class="space"> </span><span>enabled</span><span class="space"> </span><span>by</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>default.</span><span class="space"> </span><span>It&#39;s</span><span class="space"> </span><span>default</span><span class="space"> </span><span>setting</span><span class="space"> </span><span>is</span><span class="space"> </span><span>log_bin=binlog</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>disable_log_bin</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>Remove</span><span class="space"> </span><span>leading</span><span class="space"> </span><span>#</span><span class="space"> </span><span>to</span><span class="space"> </span><span>set</span><span class="space"> </span><span>options</span><span class="space"> </span><span>mainly</span><span class="space"> </span><span>useful</span><span class="space"> </span><span>for</span><span class="space"> </span><span>reporting</span><span class="space"> </span><span>servers.</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>The</span><span class="space"> </span><span>server</span><span class="space"> </span><span>defaults</span><span class="space"> </span><span>are</span><span class="space"> </span><span>faster</span><span class="space"> </span><span>for</span><span class="space"> </span><span>transactions</span><span class="space"> </span><span>and</span><span class="space"> </span><span>fast</span><span class="space"> </span><span>SELECTs.</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>Adjust</span><span class="space"> </span><span>sizes</span><span class="space"> </span><span>as</span><span class="space"> </span><span>needed,</span><span class="space"> </span><span>experiment</span><span class="space"> </span><span>to</span><span class="space"> </span><span>find</span><span class="space"> </span><span>the</span><span class="space"> </span><span>optimal</span><span class="space"> </span><span>values.</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>join_buffer_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>128M</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>sort_buffer_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>2M</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>read_rnd_buffer_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>2M</span></span>
<span class="line"><span>join_buffer_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>256KB</span></span>
<span class="line"><span>sort_buffer_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>512KB</span></span>
<span class="line"><span>read_rnd_buffer_size</span><span class="space"> </span><span>=</span><span class="space"> </span><span>256KB</span></span>
<span class="line"><span>#</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>Remove</span><span class="space"> </span><span>leading</span><span class="space"> </span><span>#</span><span class="space"> </span><span>to</span><span class="space"> </span><span>revert</span><span class="space"> </span><span>to</span><span class="space"> </span><span>previous</span><span class="space"> </span><span>value</span><span class="space"> </span><span>for</span><span class="space"> </span><span>default_authentication_plugin,</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>this</span><span class="space"> </span><span>will</span><span class="space"> </span><span>increase</span><span class="space"> </span><span>compatibility</span><span class="space"> </span><span>with</span><span class="space"> </span><span>older</span><span class="space"> </span><span>clients.</span><span class="space"> </span><span>For</span><span class="space"> </span><span>background,</span><span class="space"> </span><span>see:</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_default_authentication_plugin</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>default-authentication-plugin=mysql_native_password</span></span>
<span class="line"><span></span></span>
<span class="line"><span>datadir=/var/lib/mysql</span></span>
<span class="line"><span>socket=/var/lib/mysql/mysql.sock</span></span>
<span class="line"><span></span></span>
<span class="line"><span>log-error=/var/log/mysqld.log</span></span>
<span class="line"><span>pid-file=/var/run/mysqld/mysqld.pid</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#</span><span class="space"> </span><span>允许最大连接数</span></span>
<span class="line"><span>max_connections=200</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>#</span><span class="space"> </span><span>允许连接失败的次数。这是为了防止有人从该主机试图攻击数据库系统</span></span>
<span class="line"><span>max_connect_errors=10</span></span>
<span class="line"><span>#</span><span class="space"> </span><span>#</span><span class="space"> </span><span>服务端使用的字符集默认为UTF8</span></span>
<span class="line"><span>character-set-server=utf8</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="启动从节点的mysql服务" tabindex="-1"><a class="header-anchor" href="#启动从节点的mysql服务"><span>启动从节点的mysql服务</span></a></h4><p>启动服务命令</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">service</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mysqld</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">restart</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>重启服务命令</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">service</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mysqld</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">start</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查看服务状态</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">service</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mysqld</span><span class="space"> </span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">status</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="slave-从节点相关命令" tabindex="-1"><a class="header-anchor" href="#slave-从节点相关命令"><span>slave 从节点相关命令</span></a></h4><p><strong><!----></strong></p><blockquote><p>下面命令中的 <code>change master</code> 指令中需要指定的master_log_file和master_log_pos必须和上面master主节点中使用 <code>show master status</code> 命令查到的保持一致。</p></blockquote><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">#</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">设置同步主节点</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">change</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">master</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">to</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">master_host</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">10.0.20.12</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">master_port</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">3306</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">master_user</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">replication_user</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">master_password</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">acd5432</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">master_log_file</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span class="space"> </span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">master-bin.000002</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">master_log_pos</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">6580</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">get_master_public_key</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">=</span><span class="space"> </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"><span class="space"> </span><span class="space"> </span><span class="space"> </span><span class="space"> </span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">#</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">开启slave从节点</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">start</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">slave</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">#</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">关闭从节点</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">stop</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">slave</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">#</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">查看从节点的主从同步状态</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">show</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">slave</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">status</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/image-20240630172021306-BGzyn5U1.png" alt="image-20240630172021306"></p><h3 id="主从集群搭建完毕" tabindex="-1"><a class="header-anchor" href="#主从集群搭建完毕"><span>主从集群搭建完毕</span></a></h3><h4 id="验证主从集群" tabindex="-1"><a class="header-anchor" href="#验证主从集群"><span>验证主从集群</span></a></h4><p>在master主节点进行数据操作，会同步更新到从节点。</p><h5 id="测试1" tabindex="-1"><a class="header-anchor" href="#测试1"><span>测试1</span></a></h5><p>在主节点创建一个表</p><p><img src="/assets/image-20240630184022756-BWQe1zVN.png" alt="image-20240630184022756"></p><p>在从节点查看表</p><p><img src="/assets/image-20240630184239241-CbJngvyX.png" alt="image-20240630184239241"></p><h5 id="测试2" tabindex="-1"><a class="header-anchor" href="#测试2"><span>测试2</span></a></h5><p>在主节点新增数据</p><p><img src="/assets/image-20240630184352692-CIfUVP2O.png" alt="image-20240630184352692"></p><p>在从节点查看数据</p><p><img src="/assets/image-20240630184416159-zYT3eH5p.png" alt="image-20240630184416159"></p><h4 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h4><p>主从集群不能在从节点进行数据操作，从节点的数据是不会反向同步到主节点的，所以一般以从节点作为 <code>读库</code> ，主节点作为 <code>写库</code> ,这就是常说的读写分离。</p><h2 id="集群扩容" tabindex="-1"><a class="header-anchor" href="#集群扩容"><span>集群扩容</span></a></h2><p>现在已经存在了master主节点，且此时master主节点已经有了很多数据，此时再想给这个master主节点加上一个slave从节点，会有如下问题，之前数据是无法通过binlog来恢复的，这时候加新的slave节点时，需要在从节点执行 <code>change master</code> 命令前，额外增加一个数据复制操作，需要将master主节点当前的数据全部手动同步到slave节点。（最好停止所有应用服务再去操作，防止手动数据同步期间还有新的数据入库）</p><p>手动同步数据操作方式如下</p><p><strong>在master主节点导出需要同步的数据库数据</strong></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">mysqldump</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">u</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">root</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">p</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">数据库名称</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&gt;</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">数据库名称_backup</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">sql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>在slave从节点执行master主节点导出的脚本</strong></p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">mysql</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">u</span><span class="space"> </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">root</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">-</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">p</span><span class="space"> </span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">数据库名称</span><span class="space"> </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">&lt;</span><span class="space"> </span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">数据库名称_backup</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">.</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">sql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>将历史的业务数据导入到slave从节点之后，从节点就可以再继续按照上文的步骤执行 <code>change master</code> 等命令了。</p><h2 id="全库同步和部分同步" tabindex="-1"><a class="header-anchor" href="#全库同步和部分同步"><span>全库同步和部分同步</span></a></h2><p>上文目前的配置是slave从节点是会同步master主节点的全库，在实际环境中可能只需要同步master主节点的其中一个或数个库</p><p>操作方式如下：</p><p>先在masterr主节点的mysql的 <code>my.cnf</code>（默认地址：/etc/my.cnf） 里加上如下配置</p><div class="language-cnf line-numbers-mode" data-ext="cnf" data-title="cnf"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>#</span><span class="space"> </span><span>设置只同步库名为dbName1和dbName2的库</span><span class="space"> </span></span>
<span class="line"><span>binlog-do-db=dbName1</span></span>
<span class="line"><span>binlog-do-db=dbName2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后在slave从节点的mysql的 <code>my.cnf</code>（默认地址：/etc/my.cnf） 里加上如下配置</p><div class="language-cnf line-numbers-mode" data-ext="cnf" data-title="cnf"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>replicate-do-db=dbName1</span></span>
<span class="line"><span>replicate-do-db=dbName2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>如果masterr主节点和slave从节点的库名不相同，可在slave从节点的mysql的 <code>my.cnf</code> 添加如下配置</p><p>replicate­-rewrite­-db=dbName &gt; dbName1</p><p>注意：该在MySQL的新版本中已经被废弃，在MySQL 5.7及以后的版本中，使用这个选项可能会收到警告，并且在未来的MySQL版本中可能会被移除。所以最好保持主从数据库的库名一致。</p></blockquote><p>如果不是 dbName1 库的所有表数据都同步，只需要需要同步指定的数据表，则可以在slave从节点的mysql的 <code>my.cnf</code> 配置文件中加上如下配置</p><div class="language-cnf line-numbers-mode" data-ext="cnf" data-title="cnf"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>#</span><span class="space"> </span><span>如果没有指定则默认是全部表同步的（下面配置只同步dbName1库的tableName1和tableName2两个表）</span></span>
<span class="line"><span>replicate-wild-do-table=dbName1.tableName1</span></span>
<span class="line"><span>replicate-wild-do-table=dbName1.tableName2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自动清理binlog日志" tabindex="-1"><a class="header-anchor" href="#自动清理binlog日志"><span>自动清理binlog日志</span></a></h2><p>在实际环境中binlog日志是很大，为防止大量占用磁盘资源，可以在master主节点的 <code>my.cnf</code> 加上如下配置</p><div class="language-cnf line-numbers-mode" data-ext="cnf" data-title="cnf"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span>#</span><span class="space"> </span><span>设置只保留7天的二进制日志</span></span>
<span class="line"><span>expire-logs-days=7</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><!----><!----></div></main><footer class="vp-doc-footer" data-v-d52aff32 data-v-0b49aa66><!--[--><!--]--><!----><div class="contributors" aria-label="Contributors" data-v-0b49aa66><span class="contributors-label" data-v-0b49aa66>贡献者: </span><span class="contributors-info" data-v-0b49aa66><!--[--><!--[--><span class="contributor" data-v-0b49aa66>yunze</span><!----><!--]--><!--]--></span></div><nav class="prev-next" data-v-0b49aa66><div class="pager" data-v-0b49aa66><a class="vp-link no-icon link pager-link prev" href="/article/z5532878/" data-v-0b49aa66 data-v-3a9f60f0><!--[--><span class="desc" data-v-0b49aa66>上一页</span><span class="title" data-v-0b49aa66>平衡二叉树详解</span><!--]--><!----></a></div><div class="pager" data-v-0b49aa66><a class="vp-link no-icon link pager-link next" href="/article/k5ldy48q/" data-v-0b49aa66 data-v-3a9f60f0><!--[--><span class="desc" data-v-0b49aa66>下一页</span><span class="title" data-v-0b49aa66>MySQL数据库安装部署</span><!--]--><!----></a></div></nav></footer><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;" data-v-d52aff32><div style="display: flex;
align-items: center;
justify-content: center;
height: 96px"><span style="--loading-icon: url(&quot;data:image/svg+xml;utf8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; preserveAspectRatio=&#39;xMidYMid&#39; viewBox=&#39;25 25 50 50&#39;%3E%3CanimateTransform attributeName=&#39;transform&#39; type=&#39;rotate&#39; dur=&#39;2s&#39; keyTimes=&#39;0;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;360&#39;%3E%3C/animateTransform%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;20&#39; fill=&#39;none&#39; stroke=&#39;currentColor&#39; stroke-width=&#39;4&#39; stroke-linecap=&#39;round&#39;%3E%3Canimate attributeName=&#39;stroke-dasharray&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;1,200;90,200;1,200&#39;%3E%3C/animate%3E%3Canimate attributeName=&#39;stroke-dashoffset&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;-35px;-125px&#39;%3E%3C/animate%3E%3C/circle%3E%3C/svg%3E&quot;);
--icon-size: 48px;
display: inline-block;
width: var(--icon-size);
height: var(--icon-size);
background-color: currentcolor;
-webkit-mask-image: var(--loading-icon);
mask-image: var(--loading-icon);
"></span></div></div><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!--]--><button style="display:none;" type="button" class="vp-back-to-top" aria-label="back to top" data-v-0f45c45d data-v-28a72d4e><span class="percent" data-allow-mismatch data-v-28a72d4e>0%</span><span class="show icon vpi-back-to-top" data-v-28a72d4e></span><svg aria-hidden="true" data-v-28a72d4e><circle cx="50%" cy="50%" data-allow-mismatch style="stroke-dasharray:calc(0% - 12.566370614359172px) calc(314.1592653589793% - 12.566370614359172px);" data-v-28a72d4e></circle></svg></button><footer class="vp-footer" vp-footer data-v-0f45c45d data-v-e82df701><!--[--><div class="container" data-v-e82df701><p class="message" data-v-e82df701><a target="_blank" href="https://beian.mps.gov.cn/#/query/webSearch">鄂公网安备42900402000843号</a></br><a target="_blank" href="https://beian.miit.gov.cn/#/Integrated/index">鄂ICP备19029486号-5</a></p><!----></div><!--]--></footer><!--[--><!--]--><!--]--></div><!----><!--]--><!--[--><!--]--><!--]--></div><script type="module" src="/assets/app-Cx_oisp2.js" defer></script></body></html>