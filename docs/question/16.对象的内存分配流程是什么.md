---
title: 对象的内存分配流程是什么
createTime: 2025/10/26 20:28:41
permalink: /article/75wkxonw/
---

先判断栈帧（逃逸分析），然后判断老年代（大对象），再是堆内存空间的年轻代（TLAB）。

<!-- more -->

------



new一个对象时，需要在JVM的内存空间里给他分一块空间。

先通过逃逸分析判断是否对象是否有被方法以外的地方使用，如果没有，就表明他的作用域仅局限于本方法，生命同本方法一样，方法结束时就可以直接销毁。

这种对象就可以直接分配到方法的栈帧空间里，可以有效减少gc压力，当然前提是栈帧的内存空间足够，如果栈帧的内存空间不足以存放这个对象，也会使用标量替换方法，将对象分解为若干个被这个方法使用的成员变量存入栈帧、寄存器。

如果对象没有被分配到栈帧，就会继续判断其是否是大对象，如果是大对象，则直接分配到老年代，大对象的大小由`-XX:PretenureSizeThreshold`参数控制，但是只有`Serial`和`ParNew`垃圾回收器下才有效。

大对象直接分配到老年代的目的是，减少其在年轻代、survivor区之间复制来复制去，积攒分代年龄，而占用资源，且效率低。

如果不符合大对象标准，就是普通的内存分配流程，会被分配到堆内存空间的年轻代（TLAB分配，每个线程在年轻代里都会有一块私有的内存区域，这样在分配空间时就不需要加锁，效率较高），然后gc后再到survivor，最后再到老年代。

详细内容《 [JVM对象创建与内存分配机制深度剖析](../notes/interview/4.JVM/4.JVM对象创建与内存分配机制深度剖析.md) 》